<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Reference and API - SealHits</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Reference and API";
        var mkdocs_page_input_path = "reference.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> SealHits
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">SealHits</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tutorials/">Tutorials</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../how-to-guides/">How-to guides</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Reference and API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#bounding-boxes">Bounding Boxes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox">bbox</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.BearBox">BearBox</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.BearBox.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.BearBox.to_xy">to_xy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.BearBox.to_xy_raw">to_xy_raw</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.XYBox">XYBox</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYBox.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYBox.area">area</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYBox.com">com</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYBox.equals">equals</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYBox.flipv">flipv</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYBox.pair">pair</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYBox.tuple">tuple</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.XYZBox">XYZBox</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYZBox.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYZBox.com">com</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYZBox.equals">equals</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYZBox.pair">pair</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYZBox.tuple">tuple</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.bbox.XYZBox.volume">volume</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.bb_combine">bb_combine</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.bb_expand">bb_expand</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.bb_inside">bb_inside</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.bb_overlap">bb_overlap</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.bb_raw_to_fan">bb_raw_to_fan</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.bb_to_fix">bb_to_fix</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.bb_to_min">bb_to_min</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.combine_boxes">combine_boxes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.bbox.points_to_bb">points_to_bb</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#compression">Compression</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.compress">compress</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.compress.compress">compress</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.compress.decompress">decompress</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-object">Database Object</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.db">db</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.db.DB">DB</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-getters">Database Getters</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget">dbget</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_glf_filename">get_glf_filename</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_group_gid_sqlite_id">get_group_gid_sqlite_id</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_group_gid_sqlite_id_split">get_group_gid_sqlite_id_split</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_group_huid">get_group_huid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_group_id">get_group_id</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_group_track">get_group_track</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_group_uid">get_group_uid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_groups">get_groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_groups_filters">get_groups_filters</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_image_groups_by_filename">get_image_groups_by_filename</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_image_points_by_filename">get_image_points_by_filename</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_image_points_by_filename_group">get_image_points_by_filename_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_image_uid">get_image_uid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_images_group">get_images_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_images_group_sonarid">get_images_group_sonarid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_images_groups">get_images_groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_img_fname">get_img_fname</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_num_groups">get_num_groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_pgdf_filename">get_pgdf_filename</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_pgdfs">get_pgdfs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_pgdfs_distinct">get_pgdfs_distinct</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_points_from_track">get_points_from_track</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_points_group">get_points_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_sqlites">get_sqlites</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_tracks_group_uid">get_tracks_group_uid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_tracks_groups">get_tracks_groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbget.get_tracks_groups_groups_binfile">get_tracks_groups_groups_binfile</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-model">Database model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbmodel">dbmodel</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbmodel.DBModel">DBModel</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbmodel.diff_models">diff_models</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbmodel.gen_model">gen_model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-schema">Database schema</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbschema">dbschema</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-searches">Database searches</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbsearch">dbsearch</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbsearch.gid_to_fans_imgs">gid_to_fans_imgs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-setters">Database setters</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbset">dbset</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbset.set_group_huid">set_group_huid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbset.set_group_split">set_group_split</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbset.set_group_timeend">set_group_timeend</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbset.set_group_timestart">set_group_timestart</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbset.set_point_group">set_point_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbset.set_point_track">set_point_track</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-updates">Database updates</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbup">dbup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.db.dbup.update_group">update_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#image-functions">Image functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image">image</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image.draw_bb">draw_bb</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image.draw_text">draw_text</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image.fan_distort">fan_distort</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image.fits_to_np">fits_to_np</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image.get_group_images">get_group_images</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image.normalise_image">normalise_image</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.image.np_to_fits">np_to_fits</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#track-functions">Track functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.track">track</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.track.get_bounding_boxes">get_bounding_boxes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#utility-functions">Utility functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.utils">utils</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.utils.create_dir">create_dir</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.utils.dist_bearing_to_xy">dist_bearing_to_xy</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.utils.fast_find">fast_find</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.utils.find">find</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.utils.get_fan_size">get_fan_size</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#video-functions">Video functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.video">video</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.video.gen_video">gen_video</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#file-functions">File functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.files">files</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.files.bin_files_avail">bin_files_avail</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.files.get_tracks">get_tracks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.files.glf_files_avail">glf_files_avail</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.files.pgdfs_paths">pgdfs_paths</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.files.pgdfs_to_full_paths">pgdfs_to_full_paths</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ingesting-glfs">Ingesting GLFs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf">glf</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.GDat">GDat</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.get_times">get_times</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.glf_get_image">glf_get_image</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.glf_times_range">glf_times_range</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.has_track">has_track</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.process_glf_by_group">process_glf_by_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.process_glfs">process_glfs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.sort_times">sort_times</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glf.sort_times_group">sort_times_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extraction-from-glfs">Extraction from GLFs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glfextract">glfextract</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.glfextract.extract">extract</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ingesting-groups">Ingesting Groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.group">group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.group.find_group_objects">find_group_objects</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.group.fix_group_times">fix_group_times</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.group.split_groups">split_groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sources-model">Sources model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.model">model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.model.build_model">build_model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ingesting-pgdfs">Ingesting PGDFs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.pgdf">pgdf</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.pgdf.process_pgdfs">process_pgdfs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.pgdf.tracks_to_pgdfs">tracks_to_pgdfs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ingesting-from-sqlite">Ingesting from sqlite</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.sqlpam">sqlpam</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.sqlpam.SQLPAM">SQLPAM</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.sources.sqlpam.SQLPAM.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.sqlpam.TrackChild">TrackChild</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.sources.sqlpam.TrackChild.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sealhits.sources.sqlpam.TrackGroup">TrackGroup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.sources.sqlpam.TrackGroup.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sealhits.sources.sqlpam.TrackGroup.add_child">add_child</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../explanation/">Explanation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../database/">The Sealhits Database</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">SealHits</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Reference and API</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="reference-and-api">Reference and API</h1>
<p>This page covers the various functions inside the sealhits project and is intended for Python programmers.</p>
<p>There are two modules - sealhits and sealsources. Sealhits covers the database and pulling the data out for processing. Sealsources covers pulling the data in from the various databases, pgdfs and glf files.</p>
<h2 id="bounding-boxes">Bounding Boxes</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.bbox"></a>
    <div class="doc doc-contents first">

      <p>bbox.py - Classes and functions related to bounding boxes.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sealhits.bbox.BearBox" class="doc doc-heading">
            <code>BearBox</code>


</h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>sealhits/bbox.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BearBox</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bearmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">bearmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">distmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">distmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">sonar_range</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Bearings are in radians and are left-/right+ of the vertical / Y axis, but from the top. Sonar range is the range</span>
<span class="sd">        the sonar was set to in metres.</span>

<span class="sd">        Args:</span>
<span class="sd">           bearmin (float): The minimum bearing.</span>
<span class="sd">           bearmax (float): The maximum bearing.</span>
<span class="sd">           distmin (float): The minimum distance.</span>
<span class="sd">           distmax (float): The maximum distance.</span>
<span class="sd">           sonar_range (float): The range of the sonar at this point (in metres).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span> <span class="o">=</span> <span class="n">bearmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span> <span class="o">=</span> <span class="n">bearmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span> <span class="o">=</span> <span class="n">distmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span> <span class="o">=</span> <span class="n">distmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span> <span class="o">=</span> <span class="n">sonar_range</span>

    <span class="k">def</span> <span class="nf">to_xy_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">XYBox</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a bearing box that is x,y but for the RAW, non-fan image.</span>
<span class="sd">        This image may be resized from the original but is still a rectangle. with</span>
<span class="sd">        no spatial distortion.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_size (Tuple[int, int]): the size of the image this raw box belongs to (in pixels, width then height).</span>

<span class="sd">        Returns:</span>
<span class="sd">            XYBox: A new XYBox but within the *raw* image space (i.e original, not fan/polar transformed)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sealhits.btable</span> <span class="kn">import</span> <span class="n">bearing_table</span>

        <span class="k">def</span> <span class="nf">_find_idx</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bearing_table</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">i</span>

            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># xmin = int(((-self.bearing_max - math.radians(MIN_ANGLE)) / (math.radians(MAX_ANGLE) - math.radians(MIN_ANGLE))) * image_size[0])</span>
        <span class="c1"># xmax = int(((-self.bearing_min - math.radians(MIN_ANGLE)) / (math.radians(MAX_ANGLE) - math.radians(MIN_ANGLE))) * image_size[0])</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bearing_table</span><span class="p">))</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">_find_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>
        <span class="p">)</span>  <span class="c1"># Swap due to the bearings being postive to negative</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_find_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">XYBox</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a fan/polar image size return the minx/y maxx/y in pixel coordinates.</span>
<span class="sd">        Image size is width/height. Resulting xy assumes origin at top left.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_size (Tuple[int, int]): the size of the image this raw box belongs to (in pixels, width then height).</span>

<span class="sd">        Returns:</span>
<span class="sd">            XYBox: A new XYBox but within the *polar* image space (i.e fan/polar transformed, not raw rectangle)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">txy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">min_x</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">txy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_x</span><span class="p">:</span>
                <span class="n">min_x</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_x</span><span class="p">:</span>
                <span class="n">max_x</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_y</span><span class="p">:</span>
                <span class="n">min_y</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_y</span><span class="p">:</span>
                <span class="n">max_y</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.BearBox.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bearmin</span><span class="p">,</span> <span class="n">bearmax</span><span class="p">,</span> <span class="n">distmin</span><span class="p">,</span> <span class="n">distmax</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Bearings are in radians and are left-/right+ of the vertical / Y axis, but from the top. Sonar range is the range
the sonar was set to in metres.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bearmin</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>The minimum bearing.</p>
              </div>
            </li>
            <li>
              <b><code>bearmax</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>The maximum bearing.</p>
              </div>
            </li>
            <li>
              <b><code>distmin</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>The minimum distance.</p>
              </div>
            </li>
            <li>
              <b><code>distmax</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>The maximum distance.</p>
              </div>
            </li>
            <li>
              <b><code>sonar_range</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>The range of the sonar at this point (in metres).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bearmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">bearmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">distmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">distmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sonar_range</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bearings are in radians and are left-/right+ of the vertical / Y axis, but from the top. Sonar range is the range</span>
<span class="sd">    the sonar was set to in metres.</span>

<span class="sd">    Args:</span>
<span class="sd">       bearmin (float): The minimum bearing.</span>
<span class="sd">       bearmax (float): The maximum bearing.</span>
<span class="sd">       distmin (float): The minimum distance.</span>
<span class="sd">       distmax (float): The maximum distance.</span>
<span class="sd">       sonar_range (float): The range of the sonar at this point (in metres).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span> <span class="o">=</span> <span class="n">bearmin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span> <span class="o">=</span> <span class="n">bearmax</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span> <span class="o">=</span> <span class="n">distmin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span> <span class="o">=</span> <span class="n">distmax</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span> <span class="o">=</span> <span class="n">sonar_range</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.BearBox.to_xy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_xy</span><span class="p">(</span><span class="n">image_size</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Given a fan/polar image size return the minx/y maxx/y in pixel coordinates.
Image size is width/height. Resulting xy assumes origin at top left.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>image_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the size of the image this raw box belongs to (in pixels, width then height).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>XYBox</code></b>(                  <code><a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a></code>
)              –
              <div class="doc-md-description">
                <p>A new XYBox but within the <em>polar</em> image space (i.e fan/polar transformed, not raw rectangle)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">XYBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a fan/polar image size return the minx/y maxx/y in pixel coordinates.</span>
<span class="sd">    Image size is width/height. Resulting xy assumes origin at top left.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_size (Tuple[int, int]): the size of the image this raw box belongs to (in pixels, width then height).</span>

<span class="sd">    Returns:</span>
<span class="sd">        XYBox: A new XYBox but within the *polar* image space (i.e fan/polar transformed, not raw rectangle)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">txy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">dist_bearing_to_xy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span><span class="p">,</span> <span class="n">image_size</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">min_x</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">txy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_x</span><span class="p">:</span>
            <span class="n">min_x</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_x</span><span class="p">:</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_y</span><span class="p">:</span>
            <span class="n">min_y</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_y</span><span class="p">:</span>
            <span class="n">max_y</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.BearBox.to_xy_raw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_xy_raw</span><span class="p">(</span><span class="n">image_size</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return a bearing box that is x,y but for the RAW, non-fan image.
This image may be resized from the original but is still a rectangle. with
no spatial distortion.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>image_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the size of the image this raw box belongs to (in pixels, width then height).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>XYBox</code></b>(                  <code><a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a></code>
)              –
              <div class="doc-md-description">
                <p>A new XYBox but within the <em>raw</em> image space (i.e original, not fan/polar transformed)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_xy_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">XYBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a bearing box that is x,y but for the RAW, non-fan image.</span>
<span class="sd">    This image may be resized from the original but is still a rectangle. with</span>
<span class="sd">    no spatial distortion.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_size (Tuple[int, int]): the size of the image this raw box belongs to (in pixels, width then height).</span>

<span class="sd">    Returns:</span>
<span class="sd">        XYBox: A new XYBox but within the *raw* image space (i.e original, not fan/polar transformed)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sealhits.btable</span> <span class="kn">import</span> <span class="n">bearing_table</span>

    <span class="k">def</span> <span class="nf">_find_idx</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bearing_table</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>

        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># xmin = int(((-self.bearing_max - math.radians(MIN_ANGLE)) / (math.radians(MAX_ANGLE) - math.radians(MIN_ANGLE))) * image_size[0])</span>
    <span class="c1"># xmax = int(((-self.bearing_min - math.radians(MIN_ANGLE)) / (math.radians(MAX_ANGLE) - math.radians(MIN_ANGLE))) * image_size[0])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bearing_table</span><span class="p">))</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
        <span class="n">_find_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_max</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>
    <span class="p">)</span>  <span class="c1"># Swap due to the bearings being postive to negative</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_find_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

    <span class="n">ymin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_min</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_max</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar_range</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sealhits.bbox.XYBox" class="doc doc-heading">
            <code>XYBox</code>


</h2>


    <div class="doc doc-contents ">


      <p>A basic XY bounding box using minimums and maximums.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/bbox.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">XYBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A basic XY bounding box using minimums and maximums.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxy</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a 2D Bounding Box.</span>
<span class="sd">        Args:</span>
<span class="sd">            minx(int): minimum x value in pixels.</span>
<span class="sd">            miny(int): minimum y value in pixels.</span>
<span class="sd">            maxx(int): maximum x value in pixels.</span>
<span class="sd">            maxy(int): maximum y value in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">=</span> <span class="n">minx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">=</span> <span class="n">miny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">=</span> <span class="n">maxx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">=</span> <span class="n">maxy</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the area of this bbox.</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: the area</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the box as a Tuple</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int,int,int,int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pair</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the box as two Tuples</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Tuple[int,int],Tuple[int,int]]: the box as [xmin,ymin],[xmax,ymax]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">com</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the centre of this bbox.</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int,int]: the centre of this bounding box, rounded and as ints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">flipv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An in-place flip vertically.</span>

<span class="sd">        Args:</span>
<span class="sd">            img_height (int): the height of the image to which this box belongs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">=</span> <span class="n">img_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">=</span> <span class="n">img_height</span> <span class="o">-</span> <span class="n">tt</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Does this box equal another?</span>
<span class="sd">        Args:</span>
<span class="sd">            b (XYBox): the other box to compare against</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_min</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_max</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_min</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_max</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYBox.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Create a 2D Bounding Box.
Args:
    minx(int): minimum x value in pixels.
    miny(int): minimum y value in pixels.
    maxx(int): maximum x value in pixels.
    maxy(int): maximum y value in pixels.</p>

            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxy</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a 2D Bounding Box.</span>
<span class="sd">    Args:</span>
<span class="sd">        minx(int): minimum x value in pixels.</span>
<span class="sd">        miny(int): minimum y value in pixels.</span>
<span class="sd">        maxx(int): maximum x value in pixels.</span>
<span class="sd">        maxy(int): maximum y value in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">=</span> <span class="n">minx</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">=</span> <span class="n">miny</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">=</span> <span class="n">maxx</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">=</span> <span class="n">maxy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYBox.area" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">area</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the area of this bbox.
Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>int</code></b>(                  <code>int</code>
)              –
              <div class="doc-md-description">
                <p>the area</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the area of this bbox.</span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: the area</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYBox.com" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">com</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the centre of this bbox.
Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[int,int]: the centre of this bounding box, rounded and as ints.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">com</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the centre of this bbox.</span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[int,int]: the centre of this bounding box, rounded and as ints.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYBox.equals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">equals</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Does this box equal another?
Args:
    b (XYBox): the other box to compare against</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>bool</code>
              –
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Does this box equal another?</span>
<span class="sd">    Args:</span>
<span class="sd">        b (XYBox): the other box to compare against</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_min</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_max</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_min</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_max</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYBox.flipv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flipv</span><span class="p">(</span><span class="n">img_height</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>An in-place flip vertically.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>img_height</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the height of the image to which this box belongs.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">flipv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An in-place flip vertically.</span>

<span class="sd">    Args:</span>
<span class="sd">        img_height (int): the height of the image to which this box belongs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">=</span> <span class="n">img_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">=</span> <span class="n">img_height</span> <span class="o">-</span> <span class="n">tt</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYBox.pair" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pair</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the box as two Tuples</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Tuple">Tuple</span>[int, int], <span title="typing.Tuple">Tuple</span>[int, int]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[Tuple[int,int],Tuple[int,int]]: the box as [xmin,ymin],[xmax,ymax]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pair</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the box as two Tuples</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[Tuple[int,int],Tuple[int,int]]: the box as [xmin,ymin],[xmax,ymax]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYBox.tuple" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">tuple</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the box as a Tuple
Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[int, int, int, int]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[int,int,int,int]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the box as a Tuple</span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[int,int,int,int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sealhits.bbox.XYZBox" class="doc doc-heading">
            <code>XYZBox</code>


</h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>sealhits/bbox.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">XYZBox</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">minx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">minz</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxy</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxz</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise a 3D bounding box.</span>

<span class="sd">        Args:</span>
<span class="sd">            minx (int): minimum x value in pixels.</span>
<span class="sd">            miny (int): minimum y value in pixels.</span>
<span class="sd">            minz (int): minimum z value in pixels.</span>
<span class="sd">            maxx (int): maximum x value in pixels.</span>
<span class="sd">            maxy (int): maximum y value in pixels.</span>
<span class="sd">            maxz (int): maximum z value in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">=</span> <span class="n">minx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">=</span> <span class="n">miny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">minz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">=</span> <span class="n">maxx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">=</span> <span class="n">maxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">maxz</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">volume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the volume of this bbox.</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: the volume</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Z is always a minimum of 1, as zmax can equal zmin - this XYZBox is ultimately an XYBox</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>
            <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the box as a Tuple</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int,int,int,int,int,int]: the volume as xmin,ymin,zmin,xmax,ymax,zmax</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pair</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the box as two Tuples</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Tuple[int,int,int],Tuple[int,int,int]]: the volume as [xmin,ymin,zmin],[xmax,ymax,zmax]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">com</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the centre of this bbox.</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int,int,int]: the centre of this bounding box, rounded and as ints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
            <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
            <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">XYZBox</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Does this box equal another?</span>
<span class="sd">        Args:</span>
<span class="sd">            b (XYZBox): the other box to compare against</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_min</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_max</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_min</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_max</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">z_min</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">z_max</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYZBox.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">minz</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">maxz</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Initialise a 3D bounding box.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>minx</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>minimum x value in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>miny</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>minimum y value in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>minz</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>minimum z value in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>maxx</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>maximum x value in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>maxy</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>maximum y value in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>maxz</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>maximum z value in pixels.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">minx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">minz</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxy</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maxz</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise a 3D bounding box.</span>

<span class="sd">    Args:</span>
<span class="sd">        minx (int): minimum x value in pixels.</span>
<span class="sd">        miny (int): minimum y value in pixels.</span>
<span class="sd">        minz (int): minimum z value in pixels.</span>
<span class="sd">        maxx (int): maximum x value in pixels.</span>
<span class="sd">        maxy (int): maximum y value in pixels.</span>
<span class="sd">        maxz (int): maximum z value in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">=</span> <span class="n">minx</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">=</span> <span class="n">miny</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">minz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">=</span> <span class="n">maxx</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">=</span> <span class="n">maxy</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">maxz</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYZBox.com" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">com</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the centre of this bbox.
Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[int,int,int]: the centre of this bounding box, rounded and as ints.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">com</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the centre of this bbox.</span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[int,int,int]: the centre of this bounding box, rounded and as ints.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYZBox.equals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">equals</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Does this box equal another?
Args:
    b (XYZBox): the other box to compare against</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>bool</code>
              –
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">XYZBox</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Does this box equal another?</span>
<span class="sd">    Args:</span>
<span class="sd">        b (XYZBox): the other box to compare against</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_min</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">x_max</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_min</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">y_max</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">z_min</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">z_max</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYZBox.pair" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pair</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the box as two Tuples
Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Tuple">Tuple</span>[int, int, int], <span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[Tuple[int,int,int],Tuple[int,int,int]]: the volume as [xmin,ymin,zmin],[xmax,ymax,zmax]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pair</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the box as two Tuples</span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[Tuple[int,int,int],Tuple[int,int,int]]: the volume as [xmin,ymin,zmin],[xmax,ymax,zmax]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">),</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYZBox.tuple" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">tuple</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the box as a Tuple
Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[int, int, int, int, int, int]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[int,int,int,int,int,int]: the volume as xmin,ymin,zmin,xmax,ymax,zmax</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the box as a Tuple</span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[int,int,int,int,int,int]: the volume as xmin,ymin,zmin,xmax,ymax,zmax</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.bbox.XYZBox.volume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">volume</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the volume of this bbox.
Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>int</code></b>(                  <code>int</code>
)              –
              <div class="doc-md-description">
                <p>the volume</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">volume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the volume of this bbox.</span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: the volume</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Z is always a minimum of 1, as zmax can equal zmin - this XYZBox is ultimately an XYBox</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>
        <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.bb_combine" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bb_combine</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Combine two bounding boxes into one. Either XYBox or XYZBox.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>a</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox.</p>
              </div>
            </li>
            <li>
              <b><code>b</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>
              –
              <div class="doc-md-description">
                <p>Union[XYBox, XYZBox]: the combined box.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bb_combine</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine two bounding boxes into one. Either XYBox or XYZBox.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Union[XYBox, XYZBox]): the XYBox or XYZBox.</span>
<span class="sd">        b (Union[XYBox, XYZBox]): the XYBox or XYZBox.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[XYBox, XYZBox]: the combined box.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">x_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>

    <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">x_max</span><span class="p">)</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">):</span>
        <span class="n">z_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">z_max</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">XYZBox</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">z_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_max</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.bb_expand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bb_expand</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">b_size</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Expand the bounding box. bb is either an XYBox or XYZ Box. img_size
is a tuple of either (w,h) or (w,h,d). b_size is either a single int, or
a tuple of different sizes.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bb</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox to expand.</p>
              </div>
            </li>
            <li>
              <b><code>img_size</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[int, int], <span title="typing.Tuple">Tuple</span>[int, int, int]]</code>)
              –
              <div class="doc-md-description">
                <p>The size of the image to which this box belongs, in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>b_size</code></b>
                  (<code><span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>]</code>)
              –
              <div class="doc-md-description">
                <p>the amount to expand either uniformly (a single int), or expand by different amounts in each dimension.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>
              –
              <div class="doc-md-description">
                <p>Union[XYBox, XYZBox]: A new XYBox or XYZBox but within the <em>raw</em> image space (i.e original, not fan/polar transformed)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bb_expand</span><span class="p">(</span>
    <span class="n">bb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">],</span>
    <span class="n">img_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">b_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Expand the bounding box. bb is either an XYBox or XYZ Box. img_size</span>
<span class="sd">    is a tuple of either (w,h) or (w,h,d). b_size is either a single int, or</span>
<span class="sd">    a tuple of different sizes.</span>

<span class="sd">    Args:</span>
<span class="sd">        bb (Union[XYBox, XYZBox]): the XYBox or XYZBox to expand.</span>
<span class="sd">        img_size (Union[Tuple[int, int], Tuple[int, int, int]]): The size of the image to which this box belongs, in pixels.</span>
<span class="sd">        b_size (Union[int, Tuple]): the amount to expand either uniformly (a single int), or expand by different amounts in each dimension.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[XYBox, XYZBox]: A new XYBox or XYZBox but within the *raw* image space (i.e original, not fan/polar transformed)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">be</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">b_size</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># TODO - maybe raise an error/exception here?</span>
            <span class="k">return</span> <span class="n">bb</span>

        <span class="n">be</span> <span class="o">=</span> <span class="n">b_size</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">b_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bb</span>

        <span class="n">be</span> <span class="o">=</span> <span class="p">[</span><span class="n">b_size</span><span class="p">,</span> <span class="n">b_size</span><span class="p">,</span> <span class="n">b_size</span><span class="p">]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">x_min</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">y_min</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">x_max</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">y_max</span>

    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">x</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">y</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">z</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">be</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">be</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">be</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">be</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">w</span> <span class="o">+=</span> <span class="n">be</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">h</span> <span class="o">+=</span> <span class="n">be</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">XYZBox</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.bb_inside" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bb_inside</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return true if a is completely enclosed by b. False otherwise.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>a</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox.</p>
              </div>
            </li>
            <li>
              <b><code>b</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code>bool</code>
)              –
              <div class="doc-md-description">
                <p>is a <em>completely</em> enclosed by b?</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bb_inside</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return true if a is completely enclosed by b. False otherwise.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Union[XYBox, XYZBox]): the XYBox or XYZBox.</span>
<span class="sd">        b (Union[XYBox, XYZBox]): the XYBox or XYZBox.</span>

<span class="sd">    Returns:</span>
<span class="sd">       bool: is a *completely* enclosed by b?</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">x_min</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">x_min</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">x_max</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">x_max</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">y_min</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">y_min</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">y_max</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">y_max</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">z_min</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">z_min</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">z_max</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">z_max</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.bb_overlap" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bb_overlap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return True if two boxes overlap, False if not. Takes either an XYBox or
XYZ box. For now, both a and b must be the same type, else False is returned.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>a</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox.</p>
              </div>
            </li>
            <li>
              <b><code>b</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code>bool</code>
)              –
              <div class="doc-md-description">
                <p>do a and b overlap?</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bb_overlap</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if two boxes overlap, False if not. Takes either an XYBox or</span>
<span class="sd">    XYZ box. For now, both a and b must be the same type, else False is returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Union[XYBox, XYZBox]): the XYBox or XYZBox.</span>
<span class="sd">        b (Union[XYBox, XYZBox]): the XYBox or XYZBox.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: do a and b overlap?</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">x_min</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">x_max</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">x_max</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">x_min</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">y_min</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">y_max</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">y_max</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">y_min</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">z_min</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">z_max</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">z_max</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">z_min</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.bb_raw_to_fan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bb_raw_to_fan</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">raw_size</span><span class="p">,</span> <span class="n">fan_size</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given an XY or XYZ bounding box in the raw image space, convert
to fan space.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bbox</code></b>
                  (<code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>)
              –
              <div class="doc-md-description">
                <p>the XYBox or XYZBox to convert.</p>
              </div>
            </li>
            <li>
              <b><code>raw_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the size of the raw rectangle.</p>
              </div>
            </li>
            <li>
              <b><code>fan_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the size of the fan image.</p>
              </div>
            </li>
            <li>
              <b><code>sonar_range</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>the range of the sonar in this image</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]</code>
              –
              <div class="doc-md-description">
                <p>Union[XYBox, XYZBox]: the new XYBox or XYZBox.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bb_raw_to_fan</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">],</span>
    <span class="n">raw_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
    <span class="n">fan_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
    <span class="n">sonar_range</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given an XY or XYZ bounding box in the raw image space, convert</span>
<span class="sd">    to fan space.</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox (Union[XYBox, XYZBox]): the XYBox or XYZBox to convert.</span>
<span class="sd">        raw_size (Tuple[int, int]): the size of the raw rectangle.</span>
<span class="sd">        fan_size (Tuple[int, int]): the size of the fan image.</span>
<span class="sd">        sonar_range (float): the range of the sonar in this image</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[XYBox, XYZBox]: the new XYBox or XYZBox.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sealhits.btable</span> <span class="kn">import</span> <span class="n">bearing_table</span>

    <span class="n">x_min</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bearing_table</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">y_min</span> <span class="o">/</span> <span class="n">raw_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sonar_range</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">y_max</span> <span class="o">/</span> <span class="n">raw_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sonar_range</span>

    <span class="n">txy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist_bearing_to_xy</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">,</span> <span class="n">fan_size</span><span class="p">))</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist_bearing_to_xy</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">,</span> <span class="n">fan_size</span><span class="p">))</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist_bearing_to_xy</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">,</span> <span class="n">fan_size</span><span class="p">))</span>
    <span class="n">txy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist_bearing_to_xy</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">,</span> <span class="n">fan_size</span><span class="p">))</span>

    <span class="n">min_x</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="n">txy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">txy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_x</span><span class="p">:</span>
            <span class="n">min_x</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_x</span><span class="p">:</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_y</span><span class="p">:</span>
            <span class="n">min_y</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_y</span><span class="p">:</span>
            <span class="n">max_y</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.bb_to_fix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bb_to_fix</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">fix_size</span><span class="p">,</span> <span class="n">image_size</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given an XYBox, a fix_size and image_size, return an xy crop size that has a fixed size.
Image size is width/height.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bbox</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a></code>)
              –
              <div class="doc-md-description">
                <p>the XYBox we are changing.</p>
              </div>
            </li>
            <li>
              <b><code>fix_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the new fixed size.</p>
              </div>
            </li>
            <li>
              <b><code>image_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the size of the image to which this bbox belongs.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>XYBox</code></b>(                  <code><a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a></code>
)              –
              <div class="doc-md-description">
                <p>the new XYBox with the new size.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bb_to_fix</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">XYBox</span><span class="p">,</span> <span class="n">fix_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">XYBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given an XYBox, a fix_size and image_size, return an xy crop size that has a fixed size.</span>
<span class="sd">    Image size is width/height.</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox (XYBox): the XYBox we are changing.</span>
<span class="sd">        fix_size (Tuple[int, int]): the new fixed size.</span>
<span class="sd">        image_size (Tuple[int, int]): the size of the image to which this bbox belongs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        XYBox: the new XYBox with the new size.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="p">((</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">),</span> <span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">))</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">pair</span><span class="p">()</span>

    <span class="n">cx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_x</span> <span class="o">+</span> <span class="n">min_x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">cy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_y</span> <span class="o">+</span> <span class="n">min_y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">s_x</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">fix_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">s_y</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">fix_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">e_x</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">fix_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">e_y</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">fix_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">s_x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">s_x</span>
        <span class="n">s_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">e_x</span> <span class="o">+=</span> <span class="n">dd</span>

    <span class="k">if</span> <span class="n">e_x</span> <span class="o">&gt;=</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">e_x</span> <span class="o">-</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_x</span> <span class="o">-=</span> <span class="n">dd</span>
        <span class="n">e_x</span> <span class="o">-=</span> <span class="n">dd</span>

    <span class="k">if</span> <span class="n">s_y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">s_y</span>
        <span class="n">s_y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">e_y</span> <span class="o">+=</span> <span class="n">dd</span>

    <span class="k">if</span> <span class="n">e_y</span> <span class="o">&gt;=</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">e_y</span> <span class="o">-</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">s_y</span> <span class="o">-=</span> <span class="n">dd</span>
        <span class="n">e_y</span> <span class="o">-=</span> <span class="n">dd</span>

    <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s_y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">e_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">e_y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.bb_to_min" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bb_to_min</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">image_size</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given an XYBox, return an xy crop size that has a minimum size
and is within the image size. Image size is height/width.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bbox</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a></code>)
              –
              <div class="doc-md-description">
                <p>the XYBox to crop.</p>
              </div>
            </li>
            <li>
              <b><code>min_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the new minimum size.</p>
              </div>
            </li>
            <li>
              <b><code>image_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the size of the image to which this bbox belongs.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>XYBox</code></b>(                  <code><a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a></code>
)              –
              <div class="doc-md-description">
                <p>the new XYBox.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bb_to_min</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">XYBox</span><span class="p">,</span> <span class="n">min_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">XYBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given an XYBox, return an xy crop size that has a minimum size</span>
<span class="sd">    and is within the image size. Image size is height/width.</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox (XYBox): the XYBox to crop.</span>
<span class="sd">        min_size (Tuple[int, int]): the new minimum size.</span>
<span class="sd">        image_size (Tuple[int, int]): the size of the image to which this bbox belongs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        XYBox: the new XYBox.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="p">((</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">),</span> <span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">))</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">pair</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">min_x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">min_y</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">x</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">min_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_y</span> <span class="o">+=</span> <span class="n">d</span>
        <span class="n">min_y</span> <span class="o">-=</span> <span class="n">d</span>

        <span class="c1"># Checks to see if we are exceeding the size of the image</span>
        <span class="k">if</span> <span class="n">min_y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">min_y</span>
            <span class="n">min_y</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_y</span> <span class="o">+=</span> <span class="n">dd</span>

        <span class="k">if</span> <span class="n">max_y</span> <span class="o">&gt;</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">min_y</span> <span class="o">-=</span> <span class="n">dd</span>
            <span class="n">max_y</span> <span class="o">-=</span> <span class="n">dd</span>

    <span class="c1"># Now do the width</span>
    <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">min_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_x</span> <span class="o">+=</span> <span class="n">d</span>
        <span class="n">min_x</span> <span class="o">-=</span> <span class="n">d</span>

        <span class="k">if</span> <span class="n">min_x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">min_x</span>
            <span class="n">min_x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_x</span> <span class="o">+=</span> <span class="n">dd</span>

        <span class="k">if</span> <span class="n">max_x</span> <span class="o">&gt;</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">min_x</span> <span class="o">-=</span> <span class="n">dd</span>
            <span class="n">max_x</span> <span class="o">-=</span> <span class="n">dd</span>

    <span class="k">return</span> <span class="n">XYBox</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">min_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.combine_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_boxes</span><span class="p">(</span><span class="n">bbs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a list of 2D or 3D bbs, combine if they overlap.
Overlapping groups are joined to create a bigger group,
which makes further overlapping easier. 2D boxes are assumed
to all be on the same Z step.</p>
<p>This algorithm has bad complexity though and needs
improvement.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bbs</code></b>
                  (<code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]]</code>)
              –
              <div class="doc-md-description">
                <p>a list of either XYBox or XYZBox.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]], <span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYZBox" href="#sealhits.bbox.XYZBox">XYZBox</a>]]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[List[Union[XYBox, XYZBox]], List[Union[XYBox, XYZBox]]]: Two lists - new boxes combined and a list of many lists of the grouped boxes.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">combine_boxes</span><span class="p">(</span><span class="n">bbs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">XYBox</span><span class="p">,</span> <span class="n">XYZBox</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a list of 2D or 3D bbs, combine if they overlap.</span>
<span class="sd">    Overlapping groups are joined to create a bigger group,</span>
<span class="sd">    which makes further overlapping easier. 2D boxes are assumed</span>
<span class="sd">    to all be on the same Z step.</span>

<span class="sd">    This algorithm has bad complexity though and needs</span>
<span class="sd">    improvement.</span>

<span class="sd">    Args:</span>
<span class="sd">        bbs (List[Union[XYBox, XYZBox]]): a list of either XYBox or XYZBox.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[Union[XYBox, XYZBox]], List[Union[XYBox, XYZBox]]]: Two lists - new boxes combined and a list of many lists of the grouped boxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">new_bbs</span> <span class="o">=</span> <span class="n">bbs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">bbs_grouped</span> <span class="o">=</span> <span class="p">[[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">new_bbs</span><span class="p">]</span>

    <span class="k">while</span> <span class="n">merged</span><span class="p">:</span>
        <span class="c1"># Create a pairwise matrix of all combinations</span>
        <span class="n">pairwise</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Divide list into pairs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_bbs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_bbs</span><span class="p">)):</span>
                <span class="n">pairwise</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

        <span class="n">merged</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Now combine if we can</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pairwise</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">new_bbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">new_bbs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">bb_overlap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                <span class="n">new_bbs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>  <span class="c1"># Pop j first as it&#39;s always larger</span>
                <span class="n">new_bbs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">bb_combine</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">bbs_grouped</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">bbs_grouped</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">e</span>
                <span class="n">bbs_grouped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">new_bbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">merged</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">del</span> <span class="n">pairwise</span><span class="p">[:]</span>

    <span class="k">return</span> <span class="n">new_bbs</span><span class="p">,</span> <span class="n">bbs_grouped</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.bbox.points_to_bb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">points_to_bb</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a list of points, generate the bounding box for them.
The list of points is from the db and is  (time, sonarid, minbearing, maxbearing, minrange,
maxrange, track, uid). All points should be from the same sonar.</p>
<p>The max sonar range can change and therefore needs to be passed in.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>points</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]</code>)
              –
              <div class="doc-md-description">
                <p>a list of Points.</p>
              </div>
            </li>
            <li>
              <b><code>sonar_range</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>the range of the sonar at this time.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="sealhits.bbox.BearBox" href="#sealhits.bbox.BearBox">BearBox</a></code>
              –
              <div class="doc-md-description">
                <p>BearBox</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">points_to_bb</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">],</span> <span class="n">sonar_range</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BearBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a list of points, generate the bounding box for them.</span>
<span class="sd">    The list of points is from the db and is  (time, sonarid, minbearing, maxbearing, minrange,</span>
<span class="sd">    maxrange, track, uid). All points should be from the same sonar.</span>

<span class="sd">    The max sonar range can change and therefore needs to be passed in.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (List[Points]): a list of Points.</span>
<span class="sd">        sonar_range (float): the range of the sonar at this time.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BearBox</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Assume the min/maxes based on the sonar</span>
    <span class="n">bearing_limits</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">MIN_ANGLE</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">MAX_ANGLE</span><span class="p">))</span>
    <span class="n">distance_limits</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">)</span>
    <span class="n">min_b</span> <span class="o">=</span> <span class="n">bearing_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">max_b</span> <span class="o">=</span> <span class="n">bearing_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_d</span> <span class="o">=</span> <span class="n">distance_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">max_d</span> <span class="o">=</span> <span class="n">distance_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># TODO - Minbearing and maxbearing have been swapped here! It works but clearly</span>
    <span class="c1"># there is an issue somehere in what min and max actually mean in the PAMGuard</span>
    <span class="c1"># database</span>
    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">maxbearing</span> <span class="o">&lt;</span> <span class="n">min_b</span> <span class="ow">and</span> <span class="n">point</span><span class="o">.</span><span class="n">maxbearing</span> <span class="o">&gt;=</span> <span class="n">bearing_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">min_b</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">maxbearing</span>

        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">minbearing</span> <span class="o">&gt;</span> <span class="n">max_b</span> <span class="ow">and</span> <span class="n">point</span><span class="o">.</span><span class="n">minbearing</span> <span class="o">&lt;</span> <span class="n">bearing_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">max_b</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">minbearing</span>

        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">minrange</span> <span class="o">&lt;</span> <span class="n">min_d</span> <span class="ow">and</span> <span class="n">point</span><span class="o">.</span><span class="n">minrange</span> <span class="o">&gt;=</span> <span class="n">distance_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">min_d</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">minrange</span>

        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">maxrange</span> <span class="o">&gt;</span> <span class="n">max_d</span> <span class="ow">and</span> <span class="n">point</span><span class="o">.</span><span class="n">maxrange</span> <span class="o">&lt;</span> <span class="n">distance_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">max_d</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">maxrange</span>

    <span class="n">bb</span> <span class="o">=</span> <span class="n">BearBox</span><span class="p">(</span><span class="n">min_b</span><span class="p">,</span> <span class="n">max_b</span><span class="p">,</span> <span class="n">min_d</span><span class="p">,</span> <span class="n">max_d</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bb</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="compression">Compression</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.compress"></a>
    <div class="doc doc-contents first">

      <p>compress.py - image compression and decompression. </p>
<p>Functions related to compressing and decompressing images. We
use LZ4 as the various python zip routines are quite slow.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.compress.compress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">image_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a FITS hdul, write this out to an lz4 compressed file.
We unfortunately need to take the data out of the hdul and put it
back in, so we just take the np.array and header as is.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>the image to save.</p>
              </div>
            </li>
            <li>
              <b><code>header</code></b>
                  (<code>PrimaryHDU</code>)
              –
              <div class="doc-md-description">
                <p>the header to add to the FITS file.</p>
              </div>
            </li>
            <li>
              <b><code>image_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the image to save.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/compress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">,</span> <span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Given a FITS hdul, write this out to an lz4 compressed file.</span>
<span class="sd">    We unfortunately need to take the data out of the hdul and put it</span>
<span class="sd">    back in, so we just take the np.array and header as is.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.array): the image to save.</span>
<span class="sd">        header (PrimaryHDU): the header to add to the FITS file.</span>
<span class="sd">        image_path (str): the image to save.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.lz4&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">lz4</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fits</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.compress.decompress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decompress</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Decompress with LZ4. We have to return the data from within
the lz4 context so we assume only one HDU which is true for our
data at present.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>image_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the LZ4 image we want to decompress.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.array">array</span>, <span title="astropy.io.fits.hdu.image.PrimaryHDU">PrimaryHDU</span>]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[np.array, fits.hdu.image.PrimaryHDU]: the image as a numpy array, and the FITS Primary HDU.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/compress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decompress</span><span class="p">(</span><span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Decompress with LZ4. We have to return the data from within</span>
<span class="sd">    the lz4 context so we assume only one HDU which is true for our</span>
<span class="sd">    data at present.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_path (str): the path to the LZ4 image we want to decompress.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.array, fits.hdu.image.PrimaryHDU]: the image as a numpy array, and the FITS Primary HDU.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">image_path</span><span class="p">))</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.lz4&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">lz4</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lazy_load_hdus</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="database-object">Database Object</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.db.db"></a>
    <div class="doc doc-contents first">

      <p>db.py - The Postgresql Database Object.</p>
<p>This file holds the class that represents everything about our 
data. We use SQLAlchemy as the ORM to wrap the various postgresql
commands and schemas.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sealhits.db.db.DB" class="doc doc-heading">
            <code>DB</code>


</h2>


    <div class="doc doc-contents ">


      <p>Our database class that holds the engine and ORM and what not.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/db/db.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DB</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Our database class that holds the engine and ORM and what not.&quot;&quot;&quot;</span>
    <span class="c1"># TODO - Import the many functions onto this class (perhaps there is a better way?)</span>

    <span class="kn">from</span> <span class="nn">sealhits.db.dbget</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">get_groups</span><span class="p">,</span>
        <span class="n">get_num_groups</span><span class="p">,</span>
        <span class="n">get_groups_filters</span><span class="p">,</span>
        <span class="n">get_pgdf_filename</span><span class="p">,</span>
        <span class="n">get_glf_filename</span><span class="p">,</span>
        <span class="n">get_group_id</span><span class="p">,</span>
        <span class="n">get_group_uid</span><span class="p">,</span>
        <span class="n">get_group_huid</span><span class="p">,</span>
        <span class="n">get_sqlites</span><span class="p">,</span>
        <span class="n">get_points_group</span><span class="p">,</span>
        <span class="n">get_pgdfs</span><span class="p">,</span>
        <span class="n">get_pgdfs_distinct</span><span class="p">,</span>
        <span class="n">get_group_gid_sqlite_id_split</span><span class="p">,</span>
        <span class="n">get_group_gid_sqlite_id</span><span class="p">,</span>
        <span class="n">get_group_track</span><span class="p">,</span>
        <span class="n">get_images_groups</span><span class="p">,</span>
        <span class="n">get_tracks_groups</span><span class="p">,</span>
        <span class="n">get_tracks_groups_groups_binfile</span><span class="p">,</span>
        <span class="n">get_image_points_by_filename</span><span class="p">,</span>
        <span class="n">get_image_points_by_filename_group</span><span class="p">,</span>
        <span class="n">get_image_groups_by_filename</span><span class="p">,</span>
        <span class="n">get_tracks_group_uid</span><span class="p">,</span>
        <span class="n">get_points_from_track</span><span class="p">,</span>
        <span class="n">get_images_group</span><span class="p">,</span>
        <span class="n">get_images_group_sonarid</span><span class="p">,</span>
        <span class="n">get_image_uid</span><span class="p">,</span>
        <span class="n">get_img_fname</span>
    <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">sealhits.db.dbset</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">set_group_timestart</span><span class="p">,</span>
        <span class="n">set_group_timeend</span><span class="p">,</span>
        <span class="n">set_point_track</span><span class="p">,</span>
        <span class="n">set_point_group</span><span class="p">,</span>
        <span class="n">set_group_split</span><span class="p">,</span>
        <span class="n">set_group_huid</span>
    <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">sealhits.db.dbdel</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">del_by_sqlite</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">con_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;postgresql+psycopg2://&quot;</span>
            <span class="o">+</span> <span class="n">username</span>
            <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
            <span class="o">+</span> <span class="n">password</span>
            <span class="o">+</span> <span class="s2">&quot;@&quot;</span>
            <span class="o">+</span> <span class="n">host</span>
            <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
            <span class="o">+</span> <span class="n">db_name</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">con_str</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="n">echo</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="database-getters">Database Getters</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.db.dbget"></a>
    <div class="doc doc-contents first">

      <p>dbget.py - The Postgresql getter functions.</p>
<p>These functions retrieve records from the db, performing certain
queries to return the data required.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_glf_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_glf_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a single GLF matching the filename.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fname</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the filename to match against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.GLFS">GLFS</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[GLFS | None]: either the matching GLFS or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_glf_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GLFS</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a single GLF matching the filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        fname (str): the filename to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[GLFS | None]: either the matching GLFS or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">GLFS</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GLFS</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_group_gid_sqlite_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_gid_sqlite_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">sqlite_name</span><span class="p">,</span> <span class="n">sqliteid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a Groups object matching the gid, sqliteid and sqlite name.
These three fields combine for a unique key - a bit too complicated sadly.
We want all the splits.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>gid</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the uid to match against.</p>
              </div>
            </li>
            <li>
              <b><code>sqlite_name</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>value matched against the "sqlite" field in the Groups Schema.</p>
              </div>
            </li>
            <li>
              <b><code>sqliteid</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>value matched against the "sqliteid" field in the Groups Schema.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>] | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[List[Groups] | None] : Either a list of matching Groups or None</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group_gid_sqlite_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">gid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sqlite_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sqliteid</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a Groups object matching the gid, sqliteid and sqlite name.</span>
<span class="sd">    These three fields combine for a unique key - a bit too complicated sadly.</span>
<span class="sd">    We want all the splits.</span>

<span class="sd">    Args:</span>
<span class="sd">        gid (int): the uid to match against.</span>
<span class="sd">        sqlite_name (str): value matched against the &quot;sqlite&quot; field in the Groups Schema.</span>
<span class="sd">        sqliteid (int): value matched against the &quot;sqliteid&quot; field in the Groups Schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[List[Groups] | None] : Either a list of matching Groups or None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">gid</span> <span class="o">==</span> <span class="n">gid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">==</span> <span class="n">sqlite_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">sqliteid</span> <span class="o">==</span> <span class="n">sqliteid</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_group_gid_sqlite_id_split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_gid_sqlite_id_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">sqlite_name</span><span class="p">,</span> <span class="n">sqliteid</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a Groups object matching the gid, sqliteid, split and sqlite name.
These four fields combine for a unique key.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>gid</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the uid to match against.</p>
              </div>
            </li>
            <li>
              <b><code>sqlite_name</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>value matched against the "sqlite" field in the Groups Schema.</p>
              </div>
            </li>
            <li>
              <b><code>sqliteid</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>value matched against the "sqliteid" field in the Groups Schema.</p>
              </div>
            </li>
            <li>
              <b><code>split</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>value matched against the "split" field in the Groups Schema.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.Groups">Groups</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Groups | None]: either the matching 'Groups' or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group_gid_sqlite_id_split</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">gid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sqlite_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sqliteid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Groups</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a Groups object matching the gid, sqliteid, split and sqlite name.</span>
<span class="sd">    These four fields combine for a unique key.</span>

<span class="sd">    Args:</span>
<span class="sd">        gid (int): the uid to match against.</span>
<span class="sd">        sqlite_name (str): value matched against the &quot;sqlite&quot; field in the Groups Schema.</span>
<span class="sd">        sqliteid (int): value matched against the &quot;sqliteid&quot; field in the Groups Schema.</span>
<span class="sd">        split (int): value matched against the &quot;split&quot; field in the Groups Schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Groups | None]: either the matching &#39;Groups&#39; or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">gid</span> <span class="o">==</span> <span class="n">gid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">==</span> <span class="n">sqlite_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">sqliteid</span> <span class="o">==</span> <span class="n">sqliteid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">split</span> <span class="o">==</span> <span class="n">split</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_group_huid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_huid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">huid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a Groups object matching the human uid. Should be
only one but we can't be sure.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>huid</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the huid to match against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.Groups">Groups</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Groups | None]: either the matching 'Groups' or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group_huid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">huid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Groups</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a Groups object matching the human uid. Should be</span>
<span class="sd">    only one but we can&#39;t be sure.</span>

<span class="sd">    Args:</span>
<span class="sd">        huid (str): the huid to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Groups | None]: either the matching &#39;Groups&#39; or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">huid</span> <span class="o">==</span> <span class="n">huid</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_group_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get a group with either a string UID, or a HUID.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>id</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the id either as a UUID or a HUID.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.Groups">Groups</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Groups | None]: either the matching 'Groups' or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Groups</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a group with either a string UID, or a HUID.</span>

<span class="sd">    Args:</span>
<span class="sd">        id (str): the id either as a UUID or a HUID.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Groups | None]: either the matching &#39;Groups&#39; or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group_huid</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_group_track" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a group, given a track uid.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>track_id</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>the uid of the track to match against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.Groups">Groups</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Groups | None]: either the matching 'Groups' or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_id</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Groups</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a group, given a track uid.</span>

<span class="sd">    Args:</span>
<span class="sd">        track_id (uuid.uuid4): the uid of the track to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Groups | None]: either the matching &#39;Groups&#39; or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">TrackGroup</span><span class="o">.</span><span class="n">group_id</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">TrackGroup</span><span class="o">.</span><span class="n">track_id</span> <span class="o">==</span> <span class="n">track_id</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_group_uid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a Groups object matching the uid.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uid</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>the uid to match against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.Groups">Groups</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Groups | None]: either the matching 'Groups' or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Groups</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a Groups object matching the uid.</span>

<span class="sd">    Args:</span>
<span class="sd">        uid (uuid.uuid4): the uid to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Groups | None]: either the matching &#39;Groups&#39; or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">uid</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_groups" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>return all the groups, ordered by the pamguard sqlite uid ascending. Optionally
a search can be made using a code.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>code</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>a string to match against the 'code' field on groups.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Groups]: the resulting list of 'Groups'</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return all the groups, ordered by the pamguard sqlite uid ascending. Optionally</span>
<span class="sd">    a search can be made using a code.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): a string to match against the &#39;code&#39; field on groups.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Groups]: the resulting list of &#39;Groups&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span>
                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="p">)</span>
                <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">gid</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">gid</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_groups_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_groups_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return groups using a number of filters that the user can pass in.
Filters is a list or tuple containing an appropriate filters for groups such
as Groups.mammal &gt; 1. Filters must be a list or tuple, not a single filter on
it's own (though a single filter can be used so long as it's inside a list.)</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filters</code></b>
                  (<code>List[]</code>)
              –
              <div class="doc-md-description">
                <p>as list of 'filters' such as 'Groups.mammal &gt; 1'</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Groups]: the resulting list of 'Groups'</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_groups_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return groups using a number of filters that the user can pass in.</span>
<span class="sd">    Filters is a list or tuple containing an appropriate filters for groups such</span>
<span class="sd">    as Groups.mammal &gt; 1. Filters must be a list or tuple, not a single filter on</span>
<span class="sd">    it&#39;s own (though a single filter can be used so long as it&#39;s inside a list.)</span>

<span class="sd">    Args:</span>
<span class="sd">        filters (List[]): as list of &#39;filters&#39; such as &#39;Groups.mammal &gt; 1&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Groups]: the resulting list of &#39;Groups&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">q</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_image_groups_by_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_image_groups_by_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a list of all the groups in the image with this filename.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the image filename to check against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Groups]: List of matching Groups.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_image_groups_by_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of all the groups in the image with this filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): the image filename to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[Groups]: List of matching Groups.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">Groups</span><span class="p">,</span> <span class="n">groups_images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">groups_images</span><span class="p">,</span> <span class="n">Images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">filename</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">scalars</span><span class="p">()</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_images_groups failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_image_points_by_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_image_points_by_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagefile</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get all the points for a particular image regardless of group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>imagefile</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the name of the imagefile to match against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Points]: List of matching Points.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_image_points_by_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagefile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all the points for a particular image regardless of group.</span>

<span class="sd">    Args:</span>
<span class="sd">        imagefile (str): the name of the imagefile to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[Points]: List of matching Points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">select</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">,</span> <span class="n">Points</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">,</span> <span class="n">Groups</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">Groups</span><span class="p">,</span> <span class="n">groups_images</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">groups_images</span><span class="p">,</span> <span class="n">Images</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">hastrack</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">sonarid</span> <span class="o">==</span> <span class="n">Images</span><span class="o">.</span><span class="n">sonarid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">imagefile</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">scalars</span><span class="p">()</span>
            <span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_image_points_by_filename_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_image_points_by_filename_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagefile</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get all the tracks in an annotated group for this single image.
We use the groups_key on points to do the matching.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>imagefile</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the image filename to check against.</p>
              </div>
            </li>
            <li>
              <b><code>group_id</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="uuid.UUID">UUID</span>, str]</code>)
              –
              <div class="doc-md-description">
                <p>group to match against, either with a uuid or huid string.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Points]: List of matching Points.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_image_points_by_filename_group</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">imagefile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all the tracks in an annotated group for this single image.</span>
<span class="sd">    We use the groups_key on points to do the matching.</span>

<span class="sd">    Args:</span>
<span class="sd">        imagefile (str): the image filename to check against.</span>
<span class="sd">        group_id (Union[uuid.UUID, str]): group to match against, either with a uuid or huid string.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[Points]: List of matching Points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">group_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">huid</span> <span class="o">==</span> <span class="n">group_id</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">select</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">Groups</span><span class="p">,</span> <span class="n">Points</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">Groups</span><span class="p">,</span> <span class="n">groups_images</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">groups_images</span><span class="p">,</span> <span class="n">Images</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">Groups</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">imagefile</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">Images</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">sonarid</span> <span class="o">==</span> <span class="n">Images</span><span class="o">.</span><span class="n">sonarid</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">scalars</span><span class="p">()</span>
            <span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_image_uid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_image_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_uid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Does this image exist already? Return it if it does or None if not.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>image_uid</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>the uid of the image</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.Images">Images</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Images | None]: List of matching Images or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_image_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Images</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Does this image exist already? Return it if it does or None if not.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_uid (uuid.uuid4): the uid of the image</span>

<span class="sd">    Returns:</span>
<span class="sd">       Union[Images | None]: List of matching Images or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Images</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">image_uid</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_image_uid failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_images_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_images_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a group uid return all the images for this group
in order. Group_uid can be either uuid.UUID4 or a string
representing the huid.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_id</code></b>
                  (<code><span title="typing.Union">Union</span>[str, <span title="uuid.UUID">UUID</span>]</code>)
              –
              <div class="doc-md-description">
                <p>either the huid (str) or uid (uuid) of the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Images">Images</span>], None]</code>
              –
              <div class="doc-md-description">
                <p>Union[List[Images], None]: List of matching Images or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_images_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Images</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a group uid return all the images for this group</span>
<span class="sd">    in order. Group_uid can be either uuid.UUID4 or a string</span>
<span class="sd">    representing the huid.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_id (Union[str, uuid.UUID]): either the huid (str) or uid (uuid) of the group.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Union[List[Images], None]: List of matching Images or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">group_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">huid</span> <span class="o">==</span> <span class="n">group_id</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="n">select</span><span class="p">(</span><span class="n">Images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">Groups</span><span class="p">,</span> <span class="n">groups_images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">groups_images</span><span class="p">,</span> <span class="n">Images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">scalars</span><span class="p">()</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_images_group failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_images_group_sonarid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_images_group_sonarid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a group uid and a sonarid, return all the images for this group
in order. Group_id is either a uuid.uuid4 or a huid string.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_id</code></b>
                  (<code><span title="typing.Union">Union</span>[str, <span title="uuid.UUID">UUID</span>]</code>)
              –
              <div class="doc-md-description">
                <p>either the huid (str) or uid (uuid) of the group.</p>
              </div>
            </li>
            <li>
              <b><code>sonar_id</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the sonar id to check against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Images">Images</span>], None]</code>
              –
              <div class="doc-md-description">
                <p>Union[List[Images], None]: List of matching Images or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_images_group_sonarid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Images</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a group uid and a sonarid, return all the images for this group</span>
<span class="sd">    in order. Group_id is either a uuid.uuid4 or a huid string.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_id (Union[str, uuid.UUID]): either the huid (str) or uid (uuid) of the group.</span>
<span class="sd">        sonar_id (int): the sonar id to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Union[List[Images], None]: List of matching Images or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">group_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">huid</span> <span class="o">==</span> <span class="n">group_id</span><span class="p">)</span>

    <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">sonarid</span> <span class="o">==</span> <span class="n">sonar_id</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="n">select</span><span class="p">(</span><span class="n">Images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">Groups</span><span class="p">,</span> <span class="n">groups_images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">groups_images</span><span class="p">,</span> <span class="n">Images</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">scalars</span><span class="p">()</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_images_group failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_images_groups" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_images_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a list of all the images that have a group within them that is annotated
for a particular sonar. It need not have an actual track within the image, therefore
buffer images and images appearing between tracks appear as well.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sonar_id</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the sonar id to match against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Groups]: List of matching Groups</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_images_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of all the images that have a group within them that is annotated</span>
<span class="sd">    for a particular sonar. It need not have an actual track within the image, therefore</span>
<span class="sd">    buffer images and images appearing between tracks appear as well.</span>

<span class="sd">    Args:</span>
<span class="sd">        sonar_id (int): the sonar id to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Groups]: List of matching Groups</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Images</span><span class="p">,</span> <span class="n">Groups</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">sonarid</span> <span class="o">==</span> <span class="n">sonar_id</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_img_fname" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_img_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_fname</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Does this image exist already? Return it if it does or None if not.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>image_fname</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the filename of the image (minus the .lz4)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.Images">Images</span>, None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Images | None]: List of matching Images or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_img_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Images</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Does this image exist already? Return it if it does or None if not.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_fname (str): the filename of the image (minus the .lz4)</span>

<span class="sd">    Returns:</span>
<span class="sd">       Union[Images | None]: List of matching Images or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Images</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">image_fname</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">MultipleResultsFound</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_img_fname failed - result is not unique&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">NoResultFound</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Okay to pass here as this result is valid</span>
    <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_img_fname failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_num_groups" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_num_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">originals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return the count of the groups. Optionally
a search can be made using a code. Optionally, Originals means these
with a split number of 0, i.e the group from PAMGuard before it was
split by ingest.py.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>code</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>a string that matches against the 'code' field on Groups.</p>
              </div>
            </li>
            <li>
              <b><code>originals</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>return only these groups that were not generated with a split.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>int</code></b>(                  <code>int</code>
)              –
              <div class="doc-md-description">
                <p>the number of groups</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_num_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">originals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the count of the groups. Optionally</span>
<span class="sd">    a search can be made using a code. Optionally, Originals means these</span>
<span class="sd">    with a split number of 0, i.e the group from PAMGuard before it was</span>
<span class="sd">    split by ingest.py.</span>


<span class="sd">    Args:</span>
<span class="sd">        code (str): a string that matches against the &#39;code&#39; field on Groups.</span>
<span class="sd">        originals (bool): return only these groups that were not generated with a split.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: the number of groups</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># TODO - this is a bit verbose. Maybe compose where clauses?</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">originals</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">split</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">count</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">originals</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">split</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_pgdf_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pgdf_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a single PGDF matching the filename.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fname</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the filename to match against.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="sealhits.db.dbschema.PGDFS">PGDFS</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>Union[PGDFS | None]: either the matching PGDFS or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pgdf_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">PGDFS</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a single PGDF matching the filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        fname (str): the filename to match against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[PGDFS | None]: either the matching PGDFS or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">PGDFS</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">PGDFS</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_pgdfs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pgdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return all the PGDFs from the DB, with optional limit.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>limit</code></b>
                  (<code>int</code>, default:
                      <code>-1</code>
)
              –
              <div class="doc-md-description">
                <p>an optional limit on how many to return. -1 means no limit.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.PGDFS">PGDFS</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[PGDFS]: the resulting list of 'PGDFS'</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pgdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PGDFS</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all the PGDFs from the DB, with optional limit.</span>

<span class="sd">    Args:</span>
<span class="sd">        limit (int): an optional limit on how many to return. -1 means no limit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[PGDFS]: the resulting list of &#39;PGDFS&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">PGDFS</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PGDFS</span><span class="o">.</span><span class="n">startdate</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">PGDFS</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PGDFS</span><span class="o">.</span><span class="n">startdate</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_pgdfs_distinct" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pgdfs_distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return all the PGDFs with no duplicates. Why there should be duplicates I am not sure.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.PGDFS">PGDFS</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[PGDFS]: the resulting list of 'PGDFS'</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pgdfs_distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PGDFS</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all the PGDFs with no duplicates. Why there should be duplicates I am not sure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[PGDFS]: the resulting list of &#39;PGDFS&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">PGDFS</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PGDFS</span><span class="o">.</span><span class="n">startdate</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_points_from_track" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_points_from_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_uid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get all the points for a particular track, given the track_uid.
Returns a list of tuple - (time, sonarid, minbearing, maxbearing, minrange,
maxrange, track, uid).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>track_uid</code></b>
                  (<code><span title="uuid.UUID">UUID</span></code>)
              –
              <div class="doc-md-description">
                <p>the uid of the track</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Points]: List of matching Points.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_points_from_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get all the points for a particular track, given the track_uid.</span>
<span class="sd">    Returns a list of tuple - (time, sonarid, minbearing, maxbearing, minrange,</span>
<span class="sd">    maxrange, track, uid).</span>

<span class="sd">    Args:</span>
<span class="sd">        track_uid (uuid.UUID): the uid of the track</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[Points]: List of matching Points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">track_id</span> <span class="o">==</span> <span class="n">track_uid</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

            <span class="n">results</span> <span class="o">=</span> <span class="n">q</span>

        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_group_tracks_uid failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_points_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_points_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get all the points for this group. group_id can either be a uuid.uuid4
or it can be huid string.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_id</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="uuid.UUID">UUID</span>, str]</code>)
              –
              <div class="doc-md-description">
                <p>Either a uuid for uid, or a string for huid matching.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Points]: List of matching Points.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_points_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all the points for this group. group_id can either be a uuid.uuid4</span>
<span class="sd">    or it can be huid string.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_id (Union[uuid.UUID, str]): Either a uuid for uid, or a string for huid matching.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[Points]: List of matching Points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">group_uid</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
        <span class="n">group_uid</span> <span class="o">=</span> <span class="n">group_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group_huid</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>
        <span class="n">group_uid</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">uid</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group_uid</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">q</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_sqlites" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sqlites</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return the SQLites we have considered.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[str]</code>
              –
              <div class="doc-md-description">
                <p>List[str]: List of sqlites in the database as strings.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_sqlites</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the SQLites we have considered.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[str]: List of sqlites in the database as strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">())</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_tracks_group_uid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tracks_group_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get all the tracks in a particular group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_id</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="uuid.UUID">UUID</span>, str]</code>)
              –
              <div class="doc-md-description">
                <p>group to match against, either with a uuid or huid string.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.db.dbschema.TrackGroup" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>]</code>
              –
              <div class="doc-md-description">
                <p>List[TrackGroup]: List of matching TrackGroup.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_tracks_group_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrackGroup</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all the tracks in a particular group.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_id (Union[uuid.UUID, str]): group to match against, either with a uuid or huid string.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[TrackGroup]: List of matching TrackGroup.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">group_uid</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
        <span class="n">group_uid</span> <span class="o">=</span> <span class="n">group_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group_huid</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>
        <span class="n">group_uid</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">uid</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">TrackGroup</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group_uid</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

            <span class="n">results</span> <span class="o">=</span> <span class="n">q</span>

        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get_group_tracks_uid failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_tracks_groups" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tracks_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return all the track groups table.</p>
<p>Args:
    None</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.db.dbschema.TrackGroup" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>]</code>
              –
              <div class="doc-md-description">
                <p>List[TrackGroup]: List of matching TrackGroup.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_tracks_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrackGroup</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all the track groups table.</span>

<span class="sd">     Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[TrackGroup]: List of matching TrackGroup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbget.get_tracks_groups_groups_binfile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tracks_groups_groups_binfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uids</span><span class="p">,</span> <span class="n">binfile</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return all the track groups table that match the
group uids and pgdf binary file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_uids</code></b>
                  (<code><span title="typing.List">List</span>[<span title="uuid.UUID">UUID</span>]</code>)
              –
              <div class="doc-md-description">
                <p>a list of uids to match against.</p>
              </div>
            </li>
            <li>
              <b><code>binfile</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>a string that represents the binary file. Matched against binfile.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.db.dbschema.TrackGroup" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>]</code>
              –
              <div class="doc-md-description">
                <p>List[TrackGroup]: List of matching TrackGroup.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbget.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_tracks_groups_groups_binfile</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">group_uids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">],</span> <span class="n">binfile</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrackGroup</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all the track groups table that match the</span>
<span class="sd">    group uids and pgdf binary file.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_uids (List[uuid.UUID]): a list of uids to match against.</span>
<span class="sd">        binfile (str): a string that represents the binary file. Matched against binfile.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[TrackGroup]: List of matching TrackGroup.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">TrackGroup</span><span class="o">.</span><span class="n">group_id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">group_uids</span><span class="p">))</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">TrackGroup</span><span class="o">.</span><span class="n">binfile</span> <span class="o">==</span> <span class="n">binfile</span><span class="p">)</span>
            <span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">q</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="database-model">Database model</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.db.dbmodel"></a>
    <div class="doc doc-contents first">

      <p>dbmodel.py - The Postgresql database model.</p>
<p>The model of the database, with all the objects 
loaded into a session for comparison. DBModel holds a 
representation of the database in order to compare against
the real database. This comparison is used when updating the
real database with new information.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sealhits.db.dbmodel.DBModel" class="doc doc-heading">
            <code>DBModel</code>


</h2>


    <div class="doc doc-contents ">


      <p>Simmple struct like class to hold the model.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/db/dbmodel.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DBModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Simmple struct like class to hold the model.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgdfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_groups</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbmodel.diff_models" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">diff_models</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">model_a</span><span class="p">,</span> <span class="n">model_b</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Compare two models - find the objects that do not exist in model_b
 but do exist in model_a and therefore should be removed from model_a.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>the current sqlalchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>model_a</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.db.dbmodel.DBModel" href="#sealhits.db.dbmodel.DBModel">DBModel</a></code>)
              –
              <div class="doc-md-description">
                <p>the first model of the database.</p>
              </div>
            </li>
            <li>
              <b><code>model_b</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.db.dbmodel.DBModel" href="#sealhits.db.dbmodel.DBModel">DBModel</a></code>)
              –
              <div class="doc-md-description">
                <p>the second model to compare against the first.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>DBModel</code></b>(                  <code><a class="autorefs autorefs-internal" title="sealhits.db.dbmodel.DBModel" href="#sealhits.db.dbmodel.DBModel">DBModel</a></code>
)              –
              <div class="doc-md-description">
                <p>a model of the differences.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbmodel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">diff_models</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">model_a</span><span class="p">:</span> <span class="n">DBModel</span><span class="p">,</span> <span class="n">model_b</span><span class="p">:</span> <span class="n">DBModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DBModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Compare two models - find the objects that do not exist in model_b</span>
<span class="sd">     but do exist in model_a and therefore should be removed from model_a.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): the current sqlalchemy session.</span>
<span class="sd">        model_a (DBModel): the first model of the database.</span>
<span class="sd">        model_b (DBModel): the second model to compare against the first.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DBModel: a model of the differences.</span>

<span class="sd">     &quot;&quot;&quot;</span>

    <span class="n">model_diff</span> <span class="o">=</span> <span class="n">DBModel</span><span class="p">()</span>

    <span class="c1"># Start with groups</span>
    <span class="n">groups_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">model_a</span><span class="o">.</span><span class="n">groups</span><span class="p">}</span>
    <span class="n">groups_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">model_b</span><span class="o">.</span><span class="n">groups</span><span class="p">}</span>

    <span class="n">groups_diff</span> <span class="o">=</span> <span class="n">groups_a</span> <span class="o">-</span> <span class="n">groups_b</span>

    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">groups_diff</span><span class="p">:</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">one</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">model_diff</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

    <span class="c1"># Now Points</span>
    <span class="n">points_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">model_a</span><span class="o">.</span><span class="n">points</span><span class="p">}</span>
    <span class="n">points_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">model_b</span><span class="o">.</span><span class="n">points</span><span class="p">}</span>

    <span class="n">points_diff</span> <span class="o">=</span> <span class="n">points_a</span> <span class="o">-</span> <span class="n">points_b</span>

    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">points_diff</span><span class="p">:</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">one</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">model_diff</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

    <span class="c1"># Images</span>
    <span class="n">images_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">model_a</span><span class="o">.</span><span class="n">images</span><span class="p">}</span>
    <span class="n">images_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">model_b</span><span class="o">.</span><span class="n">images</span><span class="p">}</span>

    <span class="n">images_diff</span> <span class="o">=</span> <span class="n">images_a</span> <span class="o">-</span> <span class="n">images_b</span>

    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">images_diff</span><span class="p">:</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Images</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">one</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">model_diff</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

    <span class="c1"># PGDFS</span>
    <span class="n">pgdfs_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">model_a</span><span class="o">.</span><span class="n">pgdfs</span><span class="p">}</span>
    <span class="n">pgdfs_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">model_b</span><span class="o">.</span><span class="n">pgdfs</span><span class="p">}</span>

    <span class="n">pgdfs_diff</span> <span class="o">=</span> <span class="n">pgdfs_a</span> <span class="o">-</span> <span class="n">pgdfs_b</span>

    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">pgdfs_diff</span><span class="p">:</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">PGDFS</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">PGDFS</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">one</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">model_diff</span><span class="o">.</span><span class="n">pgdfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

    <span class="c1"># GLFS</span>
    <span class="n">glfs_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">model_a</span><span class="o">.</span><span class="n">glfs</span><span class="p">}</span>
    <span class="n">glfs_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">model_b</span><span class="o">.</span><span class="n">glfs</span><span class="p">}</span>

    <span class="n">glfs_diff</span> <span class="o">=</span> <span class="n">glfs_a</span> <span class="o">-</span> <span class="n">glfs_b</span>

    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">glfs_diff</span><span class="p">:</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">GLFS</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">GLFS</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">one</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">model_diff</span><span class="o">.</span><span class="n">glfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>


    <span class="c1"># TrackGroups</span>
    <span class="n">tg_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">track_id</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">model_a</span><span class="o">.</span><span class="n">track_groups</span><span class="p">}</span>
    <span class="n">tg_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">track_id</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">model_b</span><span class="o">.</span><span class="n">track_groups</span><span class="p">}</span>

    <span class="n">tg_diff</span> <span class="o">=</span> <span class="n">tg_a</span> <span class="o">-</span> <span class="n">tg_b</span>

    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">tg_diff</span><span class="p">:</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">TrackGroup</span><span class="o">.</span><span class="n">track_id</span> <span class="o">==</span> <span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">one</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">model_diff</span><span class="o">.</span><span class="n">track_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model_diff</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbmodel.gen_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_model</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">sqlname</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return the objects in our ORM model for a particular sqlname, 
within a session. Mostly this is used to compare against a recent 
ingest to see what needs to be deleted.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>the current sqlalchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>sqlname</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the sqlite file of the recent ingest.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>DBModel</code></b>(                  <code><a class="autorefs autorefs-internal" title="sealhits.db.dbmodel.DBModel" href="#sealhits.db.dbmodel.DBModel">DBModel</a></code>
)              –
              <div class="doc-md-description">
                <p>the generated model reflecting just the single sqlite ingest.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbmodel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gen_model</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sqlname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DBModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return the objects in our ORM model for a particular sqlname, </span>
<span class="sd">    within a session. Mostly this is used to compare against a recent </span>
<span class="sd">    ingest to see what needs to be deleted.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): the current sqlalchemy session.</span>
<span class="sd">        sqlname (str): The name of the sqlite file of the recent ingest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DBModel: the generated model reflecting just the single sqlite ingest.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">DBModel</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">==</span> <span class="n">sqlname</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">images</span> <span class="o">+=</span> <span class="n">group</span><span class="o">.</span><span class="n">images</span>
            <span class="n">model</span><span class="o">.</span><span class="n">pgdfs</span> <span class="o">+=</span> <span class="n">group</span><span class="o">.</span><span class="n">pgdfs</span>
            <span class="n">model</span><span class="o">.</span><span class="n">glfs</span> <span class="o">+=</span> <span class="n">group</span><span class="o">.</span><span class="n">glfs</span>

            <span class="n">tg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">TrackGroup</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="n">model</span><span class="o">.</span><span class="n">track_groups</span> <span class="o">+=</span> <span class="n">tg</span>

            <span class="n">tp</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="n">model</span><span class="o">.</span><span class="n">points</span> <span class="o">+=</span> <span class="n">tp</span>

    <span class="k">return</span>  <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="database-schema">Database schema</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.db.dbschema"></a>
    <div class="doc doc-contents first">

      <p>dbschema.py - The Postgresql schema.
author: Benjamin Blundell (bjb8@st-andrews.ac.uk)</p>
<p>The Postgresql Database Schema.
We use SQLAlchemy as the ORM to wrap the various postgresql.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sealhits.db.dbschema.TrackGroup" class="doc doc-heading">
            <code>TrackGroup</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="sealhits.db.dbschema.Base">Base</span></code></p>


      <p>Represents the tracks that are part of this group.
We use our own UUID but the constraint is that track_id and
binfile together must be unique.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/db/dbschema.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TrackGroup</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the tracks that are part of this group.</span>
<span class="sd">    We use our own UUID but the constraint is that track_id and</span>
<span class="sd">    binfile together must be unique.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;tracks_groups&quot;</span>

    <span class="n">track_pam_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">track_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">group_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span>
        <span class="n">UUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># TODO - foreign relation here?</span>
    <span class="n">binfile</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;TrackGroup(track_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">track_id</span><span class="si">!r}</span><span class="s2">, group_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">group_id</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="database-searches">Database searches</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.db.dbsearch"></a>
    <div class="doc doc-contents first">

      <p>dbsearch.py - The Postgresql search functions.</p>
<p>Various functions for finding and generating
data from our images and database.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbsearch.gid_to_fans_imgs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gid_to_fans_imgs</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">fits_path</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a GID, DB, path to fits files and sonarid, return the 
fan images for a particular group along with the filename path. The fan
image sizes are created using the heighest resolution.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uid</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>uid or huid of the group as a string.</p>
              </div>
            </li>
            <li>
              <b><code>db</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.db.db.DB" href="#sealhits.db.db.DB">DB</a></code>)
              –
              <div class="doc-md-description">
                <p>The active database object.</p>
              </div>
            </li>
            <li>
              <b><code>fits_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The path the fits files.</p>
              </div>
            </li>
            <li>
              <b><code>sonar_id</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The sonar_id.</p>
              </div>
            </li>
            <li>
              <b><code>scale_factor</code></b>
                  (<code>float</code>, default:
                      <code>1.0</code>
)
              –
              <div class="doc-md-description">
                <p>optional scaling factor for the fan images.</p>
              </div>
            </li>
            <li>
              <b><code>limit</code></b>
                  (<code>int</code>, default:
                      <code>-1</code>
)
              –
              <div class="doc-md-description">
                <p>optional number of results to process (-1 is no limit)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="numpy.array">array</span>, <span title="sealhits.db.dbschema.Images">Images</span>]]</code>
              –
              <div class="doc-md-description">
                <p>List[Tuple[np.array, Images]]: a list of both the fans and their associate Images records.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbsearch.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gid_to_fans_imgs</span><span class="p">(</span><span class="n">uid</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span><span class="n">DB</span><span class="p">,</span> <span class="n">fits_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">Images</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a GID, DB, path to fits files and sonarid, return the </span>
<span class="sd">    fan images for a particular group along with the filename path. The fan</span>
<span class="sd">    image sizes are created using the heighest resolution.</span>

<span class="sd">    Args:</span>
<span class="sd">        uid (str): uid or huid of the group as a string.</span>
<span class="sd">        db (DB): The active database object.</span>
<span class="sd">        fits_path (str): The path the fits files.</span>
<span class="sd">        sonar_id (int): The sonar_id.</span>
<span class="sd">        scale_factor (float): optional scaling factor for the fan images.</span>
<span class="sd">        limit (int): optional number of results to process (-1 is no limit)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Tuple[np.array, Images]]: a list of both the fans and their associate Images records.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_images_group</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">)</span>     

    <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>

        <span class="c1"># Do the resize only once - All images in the group</span>
        <span class="c1"># should be the same. It&#39;d be bad otherwise</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">fresult</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">fast_find</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fits_path</span><span class="p">)</span>

        <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fresult</span><span class="p">)</span>
        <span class="n">fits_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">scale_factor</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">fits_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fits_height</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">results</span><span class="p">)):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">filename</span>
            <span class="n">fresult</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">fast_find</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fits_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fresult</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Start with the sonar image</span>
                <span class="c1"># We need flip up down and left right!</span>
                <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fresult</span><span class="p">)</span>
                <span class="n">fan_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">fan_distort</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">fits_height</span><span class="p">,</span> <span class="n">btable</span><span class="o">.</span><span class="n">bearing_table</span><span class="p">)</span>
                <span class="n">current_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">fan_image</span><span class="p">)))</span>

    <span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="n">current_frames</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="database-setters">Database setters</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.db.dbset"></a>
    <div class="doc doc-contents first">

      <p>dbset.py - The Postgresql set functions.</p>
<p>The Postgresql Database SET functions.
These functions set records in the db.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbset.set_group_huid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_group_huid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">,</span> <span class="n">new_huid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Set a human readable uid.
Args:
    group_uid (uuid.uuid4): uid of the group
    new_huid(str): the new human readable ID (huid)</p>

            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_group_huid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">new_huid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a human readable uid.</span>
<span class="sd">    Args:</span>
<span class="sd">        group_uid (uuid.uuid4): uid of the group</span>
<span class="sd">        new_huid(str): the new human readable ID (huid) </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">group_uid</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;huid&quot;</span><span class="p">:</span> <span class="n">new_huid</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set_group_huid failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbset.set_group_split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_group_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">,</span> <span class="n">new_split</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Change the group split. Useful when splitting the group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_uid</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>uid of the group</p>
              </div>
            </li>
            <li>
              <b><code>new_split</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the new datetime for the group start.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_group_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">new_split</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change the group split. Useful when splitting the group.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_uid (uuid.uuid4): uid of the group</span>
<span class="sd">        new_split (int): the new datetime for the group start.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">group_uid</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="n">new_split</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set_group_split failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbset.set_group_timeend" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_group_timeend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">,</span> <span class="n">new_timeend</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Change the group timeend value. Useful when splitting the group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_uid</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>uid of the group</p>
              </div>
            </li>
            <li>
              <b><code>new_timeend</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>the new datetime for the group end.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_group_timeend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">new_timeend</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change the group timeend value. Useful when splitting the group.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_uid (uuid.uuid4): uid of the group</span>
<span class="sd">        new_timeend (datetime.datetime): the new datetime for the group end.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">group_uid</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;timeend&quot;</span><span class="p">:</span> <span class="n">new_timeend</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set_group_timeend failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbset.set_group_timestart" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_group_timestart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">,</span> <span class="n">new_timestart</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Change the group timestart value. Useful when splitting the group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_uid</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>uid of the group</p>
              </div>
            </li>
            <li>
              <b><code>new_timestart</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>the new datetime for the group start.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_group_timestart</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">group_uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">new_timestart</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change the group timestart value. Useful when splitting the group.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_uid (uuid.uuid4): uid of the group</span>
<span class="sd">        new_timestart (datetime.datetime): the new datetime for the group start.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">group_uid</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;timestart&quot;</span><span class="p">:</span> <span class="n">new_timestart</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set_group_timeend failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbset.set_point_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_point_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_id</span><span class="p">,</span> <span class="n">new_group</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Change the group that this point belongs to.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>point_id</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>uid of the point</p>
              </div>
            </li>
            <li>
              <b><code>new_group</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>the new group this point belongs to.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_point_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_id</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">new_group</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change the group that this point belongs to.</span>

<span class="sd">    Args:</span>
<span class="sd">        point_id (uuid.uuid4): uid of the point</span>
<span class="sd">        new_group (uuid.uuid4): the new group this point belongs to.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">point_id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;group_id&quot;</span><span class="p">:</span> <span class="n">new_group</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set_point_group failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbset.set_point_track" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_point_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_uid</span><span class="p">,</span> <span class="n">new_track</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Change the track that this point belongs to.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>point_uid</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>uid of the point</p>
              </div>
            </li>
            <li>
              <b><code>new_track</code></b>
                  (<code><span title="uuid.uuid4">uuid4</span></code>)
              –
              <div class="doc-md-description">
                <p>the new track this point belongs to.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_point_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">new_track</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change the track that this point belongs to.</span>

<span class="sd">    Args:</span>
<span class="sd">        point_uid (uuid.uuid4): uid of the point</span>
<span class="sd">        new_track (uuid.uuid4): the new track this point belongs to.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">point_uid</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;track_id&quot;</span><span class="p">:</span> <span class="n">new_track</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set_point_track failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="database-updates">Database updates</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.db.dbup"></a>
    <div class="doc doc-contents first">

      <p>dbupdate.py - The Postgresql update functions.</p>
<p>The Postgresql Database update functions.
Updating the objects that may already exist.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.db.dbup.update_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_group</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Update a single group. UID is the main key ingredient. 
We ignore foreign keys for now however. This function only updates the local group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>new_group</code></b>
                  (<code><span title="sealhits.db.dbschema.Groups">Groups</span></code>)
              –
              <div class="doc-md-description">
                <p>the new Groups data. We update based on the uid.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/db/dbup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_group</span><span class="p">:</span> <span class="n">Groups</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Update a single group. UID is the main key ingredient. </span>
<span class="sd">    We ignore foreign keys for now however. This function only updates the local group.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_group (Groups): the new Groups data. We update based on the uid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">exist_group</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">new_group</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">exist_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">bird</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">bird</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">code</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">comment</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">fish</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">fish</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">gid</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">gid</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">glfs</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">glfs</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">huid</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">huid</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">interact</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">interact</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">mammal</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">mammal</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">sqlite</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">sqliteid</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">sqliteid</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">split</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">timestart</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">timestart</span>
            <span class="n">exist_group</span><span class="o">.</span><span class="n">timeend</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">timeend</span>

            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="image-functions">Image functions</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.image"></a>
    <div class="doc doc-contents first">

      <p>image.py - functions for reading and drawing images.</p>
<p>Functions related to drawing out images.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.image.draw_bb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">draw_bb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#1111ff&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given an RGB Fan distorted image and a set of bb coords, draw a bounding box.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>image</code></b>
                  (<code><span title="PIL.Image">Image</span></code>)
              –
              <div class="doc-md-description">
                <p>the PIL Image to draw on.</p>
              </div>
            </li>
            <li>
              <b><code>bb</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a></code>)
              –
              <div class="doc-md-description">
                <p>the box to draw.</p>
              </div>
            </li>
            <li>
              <b><code>colour</code></b>
                  (<code>str</code>, default:
                      <code>&#39;#1111ff&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the colour of the box as an '#rrggbb' string.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_bb</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span> <span class="n">bb</span><span class="p">:</span> <span class="n">XYBox</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;#1111ff&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given an RGB Fan distorted image and a set of bb coords, draw a bounding box.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (PIL.Image): the PIL Image to draw on.</span>
<span class="sd">        bb (XYBox): the box to draw.</span>
<span class="sd">        colour (str): the colour of the box as an &#39;#rrggbb&#39; string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">image</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGB&quot;</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">pair</span><span class="p">()</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">))</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.image.draw_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">draw_text</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#1111ff&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Draw some text on our image.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>image</code></b>
                  (<code><span title="PIL.Image">Image</span></code>)
              –
              <div class="doc-md-description">
                <p>the PIL Image to draw on.</p>
              </div>
            </li>
            <li>
              <b><code>pos</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the coordinates to draw at.</p>
              </div>
            </li>
            <li>
              <b><code>colour</code></b>
                  (<code>str</code>, default:
                      <code>&#39;#1111ff&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the colour of the box as an '#rrggbb' string.</p>
              </div>
            </li>
            <li>
              <b><code>text</code></b>
                  (<code>str</code>, default:
                      <code>&#39;none&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the text to draw.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;#1111ff&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw some text on our image.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (PIL.Image): the PIL Image to draw on.</span>
<span class="sd">        pos (Tuple[int, int]): the coordinates to draw at.</span>
<span class="sd">        colour (str): the colour of the box as an &#39;#rrggbb&#39; string.</span>
<span class="sd">        text (str): the text to draw.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.image.fan_distort" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fan_distort</span><span class="p">(</span><span class="n">input_array</span><span class="p">,</span> <span class="n">fan_height</span><span class="p">,</span> <span class="n">bearing_table</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>The fan distortion function. We choose a height that works as our
scaling ratio (1.732).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>input_array</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>the image to distort.</p>
              </div>
            </li>
            <li>
              <b><code>fan_height</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the height of the resulting fan image.</p>
              </div>
            </li>
            <li>
              <b><code>bearing_table</code></b>
                  (<code><span title="numba.typed.List">List</span>[float]</code>)
              –
              <div class="doc-md-description">
                <p>The bearing table.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="numpy.ndarray">ndarray</span></code>
              –
              <div class="doc-md-description">
                <p>np.ndarray: the new fan image.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@numba</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">fan_distort</span><span class="p">(</span>
    <span class="n">input_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fan_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bearing_table</span><span class="p">:</span> <span class="n">NumbaList</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The fan distortion function. We choose a height that works as our</span>
<span class="sd">    scaling ratio (1.732).</span>

<span class="sd">    Args:</span>
<span class="sd">        input_array (np.ndarray): the image to distort.</span>
<span class="sd">        fan_height (int): the height of the resulting fan image.</span>
<span class="sd">        bearing_table (NumbaList[float]): The bearing table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: the new fan image.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fan_size</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">1.732</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">fan_height</span><span class="p">))),</span>
        <span class="n">fan_height</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># cant use get_fan_size(fan_height) function with numba sadly</span>
    <span class="n">fan_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">fan_height</span><span class="p">,</span> <span class="n">fan_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">hx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fan_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Allow any width, not just 512.</span>
    <span class="n">wratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">input_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">512.0</span>

    <span class="c1"># TODO - Definitely room for speedup here - can use tables and lookups.</span>
    <span class="c1"># TODO - bilinear filtering - but as an option as masks shouldn&#39;t be filtered.</span>

    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fan_height</span><span class="p">):</span>
        <span class="c1"># Limit x range as we progress up the fan</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">60</span><span class="p">)))</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hx</span> <span class="o">-</span> <span class="n">tt</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">fan_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hx</span> <span class="o">+</span> <span class="n">tt</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">hx</span><span class="p">)</span>
            <span class="n">bearing</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bearing</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="n">bearing_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">bearing</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bearing_deg</span> <span class="o">&gt;=</span> <span class="n">MIN_ANGLE</span> <span class="ow">and</span> <span class="n">bearing_deg</span> <span class="o">&lt;=</span> <span class="n">MAX_ANGLE</span><span class="p">:</span>
                <span class="c1"># We are inside the sweep so we need to now find the lookup</span>
                <span class="c1"># in the original image. However, we have a non-linear relationship</span>
                <span class="c1"># between the sonar x position and the true bearing, so we need</span>
                <span class="c1"># to find the closest sample point to our bearing via the lookup</span>
                <span class="c1"># table</span>
                <span class="n">bearing_sidx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">y</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">bearing</span><span class="p">))</span> <span class="o">/</span> <span class="n">fan_height</span> <span class="o">*</span> <span class="n">input_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="n">input_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">511</span><span class="p">):</span>  <span class="c1"># Size of the bearing table</span>
                    <span class="n">bt</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="o">.</span><span class="n">getitem_unchecked</span><span class="p">(</span>
                        <span class="n">idx</span>
                    <span class="p">)</span>  <span class="c1"># This seems to speed up the numbalist stuff a lot!</span>
                    <span class="n">bn</span> <span class="o">=</span> <span class="n">bearing_table</span><span class="o">.</span><span class="n">getitem_unchecked</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">bt</span> <span class="o">&gt;=</span> <span class="n">bearing</span> <span class="ow">and</span> <span class="n">bn</span> <span class="o">&lt;</span> <span class="n">bearing</span><span class="p">:</span>
                        <span class="n">bearing_sidx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">*</span> <span class="n">wratio</span><span class="p">)</span>
                        <span class="k">break</span>

                <span class="n">sample</span> <span class="o">=</span> <span class="n">input_array</span><span class="p">[</span><span class="n">distance</span><span class="p">][</span><span class="n">bearing_sidx</span><span class="p">]</span>
                <span class="n">fan_image</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span>

    <span class="k">return</span> <span class="n">fan_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.image.fits_to_np" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fits_to_np</span><span class="p">(</span><span class="n">fits_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a path to a FITS file, attempt to return the numpy array and
the fits header, or None if fails.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fits_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the fits to load.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.array">array</span>, <span title="astropy.io.fits.hdu.image.PrimaryHDU">PrimaryHDU</span>]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[np.array, fits.hdu.image.PrimaryHDU]: the loaded image as np.array and the FITS PrimaryHDU.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fits_to_np</span><span class="p">(</span><span class="n">fits_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a path to a FITS file, attempt to return the numpy array and</span>
<span class="sd">    the fits header, or None if fails.</span>

<span class="sd">    Args:</span>
<span class="sd">        fits_path (str): the path to the fits to load.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.array, fits.hdu.image.PrimaryHDU]: the loaded image as np.array and the FITS PrimaryHDU.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;.lz4&quot;</span> <span class="ow">in</span> <span class="n">fits_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">decompress</span><span class="p">(</span><span class="n">fits_path</span><span class="p">)</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fits_path</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lazy_load_hdus</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.image.get_group_images" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_images</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">fits_path</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">sonar_id</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">cache_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fan_transform</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return the image data and images for the group with this HUID. We check the
cache first. All images must be preset and the correct size, otherwise we generate
from new.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>db</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.db.db.DB" href="#sealhits.db.db.DB">DB</a></code>)
              –
              <div class="doc-md-description">
                <p>the database object.</p>
              </div>
            </li>
            <li>
              <b><code>fits_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the fits files.</p>
              </div>
            </li>
            <li>
              <b><code>group_id</code></b>
                  (<code>group_id</code>)
              –
              <div class="doc-md-description">
                <p>Union[uuid.UUID, str]): either the uid or the huid for the group.</p>
              </div>
            </li>
            <li>
              <b><code>sonar_id</code></b>
                  (<code>int</code>, default:
                      <code>854</code>
)
              –
              <div class="doc-md-description">
                <p>the id of the sonar to export.</p>
              </div>
            </li>
            <li>
              <b><code>height</code></b>
                  (<code>int</code>, default:
                      <code>400</code>
)
              –
              <div class="doc-md-description">
                <p>the height of the resulting images.</p>
              </div>
            </li>
            <li>
              <b><code>cache_path</code></b>
                  (<code>str</code>, default:
                      <code>&#39;.&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the path to the image cache.</p>
              </div>
            </li>
            <li>
              <b><code>fan_transform</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>return fans instead of rectangles.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.array">array</span>, <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Images">Images</span>]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[np.array, List[Images]]: the images as a 3D np.array and a list of Images objects for each frame/image.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group_images</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DB</span><span class="p">,</span>
    <span class="n">fits_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">group_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">sonar_id</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
    <span class="n">cache_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">fan_transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Images</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the image data and images for the group with this HUID. We check the</span>
<span class="sd">    cache first. All images must be preset and the correct size, otherwise we generate</span>
<span class="sd">    from new.</span>

<span class="sd">    Args:</span>
<span class="sd">        db (DB): the database object.</span>
<span class="sd">        fits_path (str): the path to the fits files.</span>
<span class="sd">        group_id (group_id: Union[uuid.UUID, str]): either the uid or the huid for the group.</span>
<span class="sd">        sonar_id (int): the id of the sonar to export.</span>
<span class="sd">        height (int): the height of the resulting images.</span>
<span class="sd">        cache_path (str): the path to the image cache.</span>
<span class="sd">        fan_transform (bool): return fans instead of rectangles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.array, List[Images]]: the images as a 3D np.array and a list of Images objects for each frame/image.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
        <span class="n">group_uid</span> <span class="o">=</span> <span class="n">group_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_group_huid</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>
        <span class="n">group_uid</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">uid</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_group_uid</span><span class="p">(</span><span class="n">group_uid</span><span class="p">)</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span>
    <span class="n">group_images</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_images_group_sonarid</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">)</span>
    <span class="n">imgs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_images</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_images</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No images found for group&quot;</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">np_frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Find all the images and create the base frames. Must be in the cache! Is probably</span>
    <span class="c1"># compressed as well.</span>

    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">group_images</span><span class="p">:</span>
        <span class="n">dpath</span> <span class="o">=</span> <span class="n">is_cached_fan</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">dpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">decompress</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>
            <span class="n">np_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">cached</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached</span><span class="p">:</span>
            <span class="n">fresult</span> <span class="o">=</span> <span class="n">fast_find</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">fits_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fresult</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fits_to_np</span><span class="p">(</span><span class="n">fresult</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fan_transform</span><span class="p">:</span>
                    <span class="n">fan_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">fan_distort</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">bearing_table</span><span class="p">))</span>
                    <span class="p">)</span>
                    <span class="n">np_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fan_image</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">np_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="c1"># It is possible, for some reason, that frames may not be the same size when in the RAW form, so</span>
    <span class="c1"># we run a check, making all images equal to the first. If the difference is too big we throw an error</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fan_transform</span><span class="p">:</span>
        <span class="n">tframes</span> <span class="o">=</span> <span class="n">np_frames</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">np_frames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first_shape</span> <span class="o">=</span> <span class="n">tframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">np_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tframes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">tframes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="c1"># Row differences</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">first_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;get_groups_images: RAW images in group differ too much&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">first_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Column differences</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">first_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;get_groups_images: RAW images in group differ too much&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">first_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">np_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">np_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">np_frames</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">np_frames</span><span class="p">,</span> <span class="n">imgs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.image.normalise_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalise_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Normalise the image to range 0 to 1.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>img</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>the image to normalise.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="numpy.array">array</span></code>
              –
              <div class="doc-md-description">
                <p>np.array: the normalised image (with a float32 type)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalise_image</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalise the image to range 0 to 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        img (np.array): the image to normalise.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.array: the normalised image (with a float32 type)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fimg</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">min_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">rval</span> <span class="o">=</span> <span class="p">(</span><span class="n">fimg</span> <span class="o">-</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_val</span> <span class="o">-</span> <span class="n">min_val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rval</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.image.np_to_fits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">np_to_fits</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">image_time</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given an np array, write out our fits image to a cache.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>save_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path and filename to save the fits to.</p>
              </div>
            </li>
            <li>
              <b><code>img</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>the image to save.</p>
              </div>
            </li>
            <li>
              <b><code>image_time</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>the time the image was taken.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">np_to_fits</span><span class="p">(</span><span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">image_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given an np array, write out our fits image to a cache.</span>

<span class="sd">    Args:</span>
<span class="sd">        save_path (str): the path and filename to save the fits to.</span>
<span class="sd">        img (np.array): the image to save.</span>
<span class="sd">        image_time: the time the image was taken.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;WIDTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;HEIGHT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">year</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;MONTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">month</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;DAY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">day</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;HOUR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;MINUTE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">minute</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;SECOND&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">second</span>
            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;MILLI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image_time</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">hdr</span><span class="p">)</span>
            <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">hdr</span><span class="p">])</span>
            <span class="n">hdul</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not save fits image:&quot;</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="track-functions">Track functions</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.track"></a>
    <div class="doc doc-contents first">

      <p>track.py - functions relating to tracks, such as overlaps.</p>
<p>A number of functions used to detect tracks
in the fan sonar images.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.track.get_bounding_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bounding_boxes</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">huid</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">fan_distort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get the track details for this group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>db</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.db.db.DB" href="#sealhits.db.db.DB">DB</a></code>)
              –
              <div class="doc-md-description">
                <p>the database object.</p>
              </div>
            </li>
            <li>
              <b><code>huid</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the huid for hte group we are looking for.</p>
              </div>
            </li>
            <li>
              <b><code>imgs</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Images">Images</span>]</code>)
              –
              <div class="doc-md-description">
                <p>the list of Images records for this group.</p>
              </div>
            </li>
            <li>
              <b><code>img_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>The size of the images in pixels. Width then height.</p>
              </div>
            </li>
            <li>
              <b><code>fan_distort</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Are these images fans?</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, str]]</code>
              –
              <div class="doc-md-description">
                <p>List[Tuple[int, XYBox, str]]: a list of frame numbers, bounding boxes and corresponding colours.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/track.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_bounding_boxes</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DB</span><span class="p">,</span> <span class="n">huid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">imgs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Images</span><span class="p">],</span> <span class="n">img_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">fan_distort</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">XYBox</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the track details for this group.</span>

<span class="sd">    Args:</span>
<span class="sd">        db (DB): the database object.</span>
<span class="sd">        huid (str): the huid for hte group we are looking for.</span>
<span class="sd">        imgs (List[Images]): the list of Images records for this group.</span>
<span class="sd">        img_size (Tuple[int,int]): The size of the images in pixels. Width then height.</span>
<span class="sd">        fan_distort (bool): Are these images fans?</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Tuple[int, XYBox, str]]: a list of frame numbers, bounding boxes and corresponding colours.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bbs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_group_huid</span><span class="p">(</span><span class="n">huid</span><span class="p">)</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imgs</span><span class="p">):</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_image_points_by_filename_group</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>  <span class="c1"># Since we have buffer start / end images and intermediates, 0 tracks are possible</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="n">points_to_bb</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">range</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fan_distort</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">to_xy</span><span class="p">(</span><span class="n">img_size</span><span class="p">)</span>
                <span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">))</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">pair</span><span class="p">()</span>

                <span class="c1"># Flip BBS vertically to match flipped fan (normally flipped. #TODO - We should make this consistent)</span>
                <span class="c1"># This is a bit silly it seems</span>
                <span class="n">bbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">XYBox</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">to_xy_raw</span><span class="p">(</span><span class="n">img_size</span><span class="p">)</span>

                <span class="c1"># Flip BBS vertically to match flipped fan (normally flipped. #TODO - We should make this consistent)</span>
                <span class="c1"># This is a bit silly it seems</span>
                <span class="n">bbs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">bbox</span><span class="p">))</span>

    <span class="c1"># Add a colour to the bounding box for ease of video and drawing.</span>
    <span class="n">bbs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s2">&quot;#ff0000&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">bbs</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bbs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="utility-functions">Utility functions</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.utils"></a>
    <div class="doc doc-contents first">

      <p>utils.py - misc utility functions.</p>
<p>Useful utilities for various Sealhits related tasks.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.utils.create_dir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Create a directory if it doesn't already exist.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the directory we want to make.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code>bool</code>
)              –
              <div class="doc-md-description">
                <p>success?</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_dir</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a directory if it doesn&#39;t already exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): the path to the directory we want to make.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: success?</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.utils.dist_bearing_to_xy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dist_bearing_to_xy</span><span class="p">(</span><span class="n">bearing</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">max_range</span><span class="p">,</span> <span class="n">image_size</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Convert bearing (radians) and distance from a track to fan/polar image x, y coords.
Image size is width/height. X and Y are integers within image_size.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bearing</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>the bearing in radians.</p>
              </div>
            </li>
            <li>
              <b><code>distance</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>the distance in metres.</p>
              </div>
            </li>
            <li>
              <b><code>max_range</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>the maximum possible range (the sonar range) in metres.</p>
              </div>
            </li>
            <li>
              <b><code>image_size</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[int, int]</code>)
              –
              <div class="doc-md-description">
                <p>the size of the image in pixels - width then height.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[int, int]: the x and y coordinates in pixels.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dist_bearing_to_xy</span><span class="p">(</span>
    <span class="n">bearing</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_range</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert bearing (radians) and distance from a track to fan/polar image x, y coords.</span>
<span class="sd">    Image size is width/height. X and Y are integers within image_size.</span>

<span class="sd">    Args:</span>
<span class="sd">       bearing (float): the bearing in radians.</span>
<span class="sd">       distance (float): the distance in metres.</span>
<span class="sd">       max_range (float): the maximum possible range (the sonar range) in metres.</span>
<span class="sd">       image_size: the size of the image in pixels - width then height.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tuple[int, int]: the x and y coordinates in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Assume bearing is either side of the vertical line?</span>
    <span class="c1"># Assume distance is in metres with the max being passed in as max_range</span>
    <span class="c1"># assert math.degrees(bearing) &gt;= MIN_ANGLE and math.degrees(bearing) &lt;= MAX_ANGLE</span>

    <span class="c1"># We are effectively rotating this 90 degrees anti clockwise and a POSITIVE bearing</span>
    <span class="c1"># should be to the LEFT of the centre line post rotation (this seems silly but is</span>
    <span class="c1"># the way according to PAMGuard)</span>

    <span class="c1"># TODO - we are returning integers here. We might wish to do floats at some point</span>
    <span class="c1"># so we can do interpolation.    </span>
    <span class="n">d0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span> <span class="o">/</span> <span class="n">max_range</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">bearing</span><span class="p">))</span> <span class="o">*</span> <span class="n">d0</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">bearing</span><span class="p">))</span> <span class="o">*</span> <span class="n">d0</span>

    <span class="n">hl</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">bearing</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">hl</span> <span class="o">-</span> <span class="n">x0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">hl</span> <span class="o">+</span> <span class="n">x0</span>

    <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.utils.fast_find" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fast_find</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">base_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Find the full FITS bath based on how we store the images.
This is much faster than a full path walk. We also look for
images without the .lz4 extension. We prioritise the non 
compressed file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the file we are looking for.</p>
              </div>
            </li>
            <li>
              <b><code>base_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the directory we are searching.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[str, None]</code>
              –
              <div class="doc-md-description">
                <p>Union[str, None]: the path to the file if found, or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fast_find</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the full FITS bath based on how we store the images.</span>
<span class="sd">    This is much faster than a full path walk. We also look for</span>
<span class="sd">    images without the .lz4 extension. We prioritise the non </span>
<span class="sd">    compressed file.</span>

<span class="sd">    Args:</span>
<span class="sd">       name (str): the file we are looking for.</span>
<span class="sd">       base_path (str): the directory we are searching.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Union[str, None]: the path to the file if found, or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">joined_unzipped</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">joined_unzipped</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">joined_unzipped</span>

    <span class="n">joined</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.lz4&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">joined</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">joined</span>

    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">base_path</span><span class="p">):</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tt</span><span class="p">):</span>
            <span class="n">full_path_unzipped</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">full_path_unzipped</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">full_path_unzipped</span>

            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.lz4&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">full_path</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not find:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.utils.find" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Find a file somewhere underneath path, matching the pattern.
Args:
   pattern (str): a pattern string for fnmatch.
   distance (float): a path to a directory to search.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[str]</code>
              –
              <div class="doc-md-description">
                <p>List[str]: the resulting files as full paths.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a file somewhere underneath path, matching the pattern.</span>
<span class="sd">    Args:</span>
<span class="sd">       pattern (str): a pattern string for fnmatch.</span>
<span class="sd">       distance (float): a path to a directory to search.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[str]: the resulting files as full paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.utils.get_fan_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_fan_size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a fan size, given the height. Uses a ratio of 1.732 
given the 120 degree spread.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>height</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the height we want in pixels.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[int, int]: the width and height of the fan image in pixels.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fan_size</span><span class="p">(</span><span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return a fan size, given the height. Uses a ratio of 1.732 </span>
<span class="sd">    given the 120 degree spread.</span>

<span class="sd">    Args:</span>
<span class="sd">       height (int): the height we want in pixels.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tuple[int, int]: the width and height of the fan image in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">1.732</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">))),</span> <span class="n">height</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="video-functions">Video functions</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.video"></a>
    <div class="doc doc-contents first">

      <p>video.py - create videos from a numpy array.</p>
<p>Generate video from a list of frames, bounding boxes and group
information.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.video.gen_video" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_video</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">bbs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">colour_map</span><span class="o">=</span><span class="n">Batlow_20</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given the original frames and a Bounding Box list, create our final video. The BBS list is in the format
(frame number, xmin, ymin, xmax, ymax, colour).
The path is the full path to the video file, plus the extension (which determines the type).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>frames</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>the frames that makeup the video.</p>
              </div>
            </li>
            <li>
              <b><code>bbs</code></b>
                  (<code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, <a class="autorefs autorefs-internal" title="sealhits.bbox.XYBox" href="#sealhits.bbox.XYBox">XYBox</a>, str]]</code>)
              –
              <div class="doc-md-description">
                <p>the list of bounding boxes, frame numbers and the colour.</p>
              </div>
            </li>
            <li>
              <b><code>text</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>text to draw.</p>
              </div>
            </li>
            <li>
              <b><code>out_path</code></b>
                  (<code>str</code>, default:
                      <code>&#39;.&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the full path to the video. Must end in a video type like '.mp4' or '.webm'.</p>
              </div>
            </li>
            <li>
              <b><code>colour_map</code></b>
                  (<code><span title="palettable.Palette">Palette</span></code>, default:
                      <code><span title="palettable.scientific.sequential.Batlow_20">Batlow_20</span></code>
)
              –
              <div class="doc-md-description">
                <p>the colour palette to use.</p>
              </div>
            </li>
            <li>
              <b><code>rate</code></b>
                  (<code>int</code>, default:
                      <code>4</code>
)
              –
              <div class="doc-md-description">
                <p>frames per second.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>str</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>path to the saved video.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/video.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gen_video</span><span class="p">(</span>
    <span class="n">frames</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">bbs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">XYBox</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">out_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">colour_map</span><span class="o">=</span><span class="n">Batlow_20</span><span class="p">,</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="mi">4</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given the original frames and a Bounding Box list, create our final video. The BBS list is in the format</span>
<span class="sd">    (frame number, xmin, ymin, xmax, ymax, colour).</span>
<span class="sd">    The path is the full path to the video file, plus the extension (which determines the type).</span>

<span class="sd">    Args:</span>
<span class="sd">        frames (np.array): the frames that makeup the video.</span>
<span class="sd">        bbs (List[Tuple[int, XYBox, str]]): the list of bounding boxes, frame numbers and the colour.</span>
<span class="sd">        text (str): text to draw.</span>
<span class="sd">        out_path (str): the full path to the video. Must end in a video type like &#39;.mp4&#39; or &#39;.webm&#39;.</span>
<span class="sd">        colour_map (palettable.Palette): the colour palette to use.</span>
<span class="sd">        rate (int): frames per second.</span>

<span class="sd">    Returns:</span>
<span class="sd">       str: path to the saved video.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">over_frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="s2">&quot;./Hack-Regular.ttf&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">fidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">frames</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="n">fidx</span><span class="p">]</span>
        <span class="n">blank_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">blank_image</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bbs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">frame_id</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">colour</span> <span class="ow">in</span> <span class="n">bbs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">frame_id</span> <span class="o">==</span> <span class="n">fidx</span><span class="p">:</span>
                    <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">tuple</span><span class="p">(),</span> <span class="n">outline</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>

        <span class="n">over_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">blank_image</span><span class="p">))</span>

    <span class="c1"># Now create a quick video</span>
    <span class="n">coloured</span> <span class="o">=</span> <span class="n">frames</span>

    <span class="c1"># If this is a luminance image, do the nice colour mapping</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="p">(</span><span class="n">frames</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">np_fan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normalise_image</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">coloured</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">np_fan</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="c1"># Take entries from RGB LUT according to greyscale values in image</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="p">[</span><span class="n">colour_map</span><span class="o">.</span><span class="n">mpl_colormap</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)]</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lut</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">lut</span><span class="p">,</span> <span class="n">np_fan</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">coloured</span><span class="p">)</span>

        <span class="n">np_track</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">over_frames</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">coloured</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">coloured</span><span class="p">,</span> <span class="n">np_track</span><span class="p">)</span>

    <span class="n">ffmpegio</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">coloured</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="file-functions">File functions</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.sources.files"></a>
    <div class="doc doc-contents first">

      <p>files.py - find the files on disk that we need.</p>
<p>The various functions that search out the files we want 
and the tracks we are looking for.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.files.bin_files_avail" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bin_files_avail</span><span class="p">(</span><span class="n">pdir</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return a list of binary PGDF files with the corresponding date range.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>pdir</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the gemini binary files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[str, <span title="datetime.datetime">datetime</span>, <span title="datetime.datetime">datetime</span>]]</code>
              –
              <div class="doc-md-description">
                <p>List[Tuple[str, datetime.datetime, datetime.datetime]]: A list of paths to the pgdf including the start and end datetimes</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bin_files_avail</span><span class="p">(</span>
    <span class="n">pdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of binary PGDF files with the corresponding date range.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdir (str): the path to the gemini binary files.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[Tuple[str, datetime.datetime, datetime.datetime]]: A list of paths to the pgdf including the start and end datetimes</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">efiles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pdir</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;pgdf&quot;</span> <span class="ow">in</span> <span class="n">file_extension</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opening pgdf:&quot;</span><span class="p">,</span> <span class="n">fpath</span><span class="p">)</span>
                    <span class="n">tp</span> <span class="o">=</span> <span class="n">pgdf</span><span class="o">.</span><span class="n">PGDF</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">date_min</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">date_max</span> <span class="o">=</span> <span class="kc">None</span>

                        <span class="k">for</span> <span class="n">pamobj</span> <span class="ow">in</span> <span class="n">tp</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                            <span class="n">tdate</span> <span class="o">=</span> <span class="n">pamobj</span><span class="o">.</span><span class="n">pam</span><span class="o">.</span><span class="n">date</span>
                            <span class="k">assert</span> <span class="n">tdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

                            <span class="k">if</span> <span class="n">date_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">date_min</span> <span class="o">=</span> <span class="n">tdate</span>
                            <span class="k">elif</span> <span class="n">date_min</span> <span class="o">&gt;</span> <span class="n">tdate</span><span class="p">:</span>
                                <span class="n">date_min</span> <span class="o">=</span> <span class="n">tdate</span>

                            <span class="k">if</span> <span class="n">date_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">date_max</span> <span class="o">=</span> <span class="n">tdate</span>
                            <span class="k">elif</span> <span class="n">date_max</span> <span class="o">&lt;</span> <span class="n">tdate</span><span class="p">:</span>
                                <span class="n">date_max</span> <span class="o">=</span> <span class="n">tdate</span>

                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding pgdf:&quot;</span><span class="p">,</span> <span class="n">fpath</span><span class="p">)</span>
                        <span class="n">efiles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fpath</span><span class="p">,</span> <span class="n">date_min</span><span class="p">,</span> <span class="n">date_max</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PGDF has no module objects.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not read&quot;</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="c1"># Sort the efile bases on the dates</span>
    <span class="n">efiles</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ef</span><span class="p">:</span> <span class="n">ef</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">efiles</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.files.get_tracks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tracks</span><span class="p">(</span><span class="n">bin_files</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Read the found PGDF files and generate the tracks for our eventual
dataset.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bin_files</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the PGDF files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="pypam.module.PGObject">PGObject</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[PGObject]: A list of PGObject representing tracks from PAMGuard.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_tracks</span><span class="p">(</span><span class="n">bin_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PGObject</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the found PGDF files and generate the tracks for our eventual</span>
<span class="sd">    dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        bin_files (str): the path to the PGDF files.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[PGObject]: A list of PGObject representing tracks from PAMGuard.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># TODO - it is possible that one track can cross multiple files.</span>
    <span class="c1"># We&#39;ve ignored this for now</span>
    <span class="c1"># https://github.com/PAMGuard/PAMGuardMatlab/blob/main/pgmatlab/loadPamguardMultiFile.m</span>

    <span class="c1"># UID in the track group is different to the UID in the Track group children.</span>
    <span class="c1"># Trackgroup children UID *should* match the UID in the pgdf</span>

    <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">bin_files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading bin file:&quot;</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
        <span class="n">pbin</span> <span class="o">=</span> <span class="n">pgdf</span><span class="o">.</span><span class="n">PGDF</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">pbin</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">module_type</span> <span class="o">==</span> <span class="s2">&quot;Gemini Threshold Detector&quot;</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">pbin</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c1"># Sort tracks in order of time if not already</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tracks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">track</span><span class="p">:</span> <span class="n">track</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">track</span><span class="o">.</span><span class="n">time_start</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tracks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.files.glf_files_avail" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">glf_files_avail</span><span class="p">(</span><span class="n">glf_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a starting path, find all the possible glf files.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>glf_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the GLF files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[str]</code>
              –
              <div class="doc-md-description">
                <p>List[str]: A list of full paths to all found GLF files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">glf_files_avail</span><span class="p">(</span><span class="n">glf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a starting path, find all the possible glf files.</span>

<span class="sd">    Args:</span>
<span class="sd">        glf_path (str): the path to the GLF files.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[str]: A list of full paths to all found GLF files.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">glf_path</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.glf&quot;</span><span class="p">:</span>
                <span class="n">full_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">full_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.files.pgdfs_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pgdfs_paths</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Find all PGDFs under a given path.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>pgdf_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the PGDF files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[str]</code>
              –
              <div class="doc-md-description">
                <p>List[str]: A list of full paths to all found PGDF files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pgdfs_paths</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Find all PGDFs under a given path.</span>

<span class="sd">    Args:</span>
<span class="sd">        pgdf_path (str): the path to the PGDF files.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[str]: A list of full paths to all found PGDF files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.pgdf&quot;</span><span class="p">:</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">full_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">full_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.files.pgdfs_to_full_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pgdfs_to_full_paths</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">,</span> <span class="n">pgdfs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Fill out the pgdf filenames with their full paths.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>pgdf_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the PGDFS files.</p>
              </div>
            </li>
            <li>
              <b><code>pgdfs</code></b>
                  (<code><span title="typing.List">List</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>a list of PGDF names to look for</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[str]</code>
              –
              <div class="doc-md-description">
                <p>List[str]: A list of full paths to the PGDFS in the pgdfs list.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pgdfs_to_full_paths</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pgdfs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fill out the pgdf filenames with their full paths.</span>

<span class="sd">    Args:</span>
<span class="sd">        pgdf_path (str): the path to the PGDFS files.</span>
<span class="sd">        pgdfs (List[str]): a list of PGDF names to look for</span>

<span class="sd">    Returns:</span>
<span class="sd">       List[str]: A list of full paths to the PGDFS in the pgdfs list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">pgdfs</span><span class="p">:</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">full_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">full_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="ingesting-glfs">Ingesting GLFs</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.sources.glf"></a>
    <div class="doc doc-contents first">

      <p>glf.py - all the functions related to GLF files</p>
<p>Functions for ingesting the GLF files. This involves finding the 
files on disk, picking the ones we need, reading the required
image records, then saving these images to disk as LZ4 compressed
files.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sealhits.sources.glf.GDat" class="doc doc-heading">
            <code>GDat</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>An internal object that holds all the details we want on
our GLFs as we process them.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GDat</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An internal object that holds all the details we want on</span>
<span class="sd">    our GLFs as we process them.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">startdate</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
        <span class="n">enddate</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
        <span class="n">gobj</span><span class="p">:</span> <span class="n">GLFS</span><span class="p">,</span>
        <span class="n">full_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">startdate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">enddate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gobj</span> <span class="o">=</span> <span class="n">gobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_path</span> <span class="o">=</span> <span class="n">full_path</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.get_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_times</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get the start and end times from this GLF file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>gpath</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>path to a single GLF file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="datetime.datetime">datetime</span>], None]</code>
              –
              <div class="doc-md-description">
                <p>Union[Tuple[datetime.datetime, datetime.datetime], None]: either the start and end times, or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_times</span><span class="p">(</span><span class="n">gpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the start and end times from this GLF file.</span>

<span class="sd">    Args:</span>
<span class="sd">        gpath (str): path to a single GLF file.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Union[Tuple[datetime.datetime, datetime.datetime], None]: either the start and end times, or None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">GLF</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">gf</span><span class="p">:</span>
            <span class="n">time_start</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">time_end</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">image_rec</span> <span class="ow">in</span> <span class="n">gf</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
                <span class="n">image_time</span> <span class="o">=</span> <span class="n">image_rec</span><span class="o">.</span><span class="n">db_tx_time</span>

                <span class="k">if</span> <span class="n">time_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">time_start</span> <span class="o">=</span> <span class="n">image_time</span>
                <span class="k">elif</span> <span class="n">image_time</span> <span class="o">&lt;</span> <span class="n">time_start</span><span class="p">:</span>
                    <span class="n">time_start</span> <span class="o">=</span> <span class="n">image_time</span>

                <span class="k">if</span> <span class="n">time_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">time_end</span> <span class="o">=</span> <span class="n">image_time</span>
                <span class="k">elif</span> <span class="n">image_time</span> <span class="o">&gt;</span> <span class="n">time_end</span><span class="p">:</span>
                    <span class="n">time_end</span> <span class="o">=</span> <span class="n">image_time</span>

            <span class="k">assert</span> <span class="n">time_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">time_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to read glf: </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">gpath</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.glf_get_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">glf_get_image</span><span class="p">(</span><span class="n">gpath</span><span class="p">,</span> <span class="n">image_rec</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get an image from a GLF file using the given record</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>gpath</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>path to a single GLF file.</p>
              </div>
            </li>
            <li>
              <b><code>image_rec</code></b>
                  (<code><span title="pytritech.image.ImageRecord">ImageRecord</span></code>)
              –
              <div class="doc-md-description">
                <p>the GLF File image record</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[bytes, <span title="typing.Tuple">Tuple</span>[int, int]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[bytes, Tuple[int, int]]: raw data as bytes and the width and height in pixels as ints.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">glf_get_image</span><span class="p">(</span><span class="n">gpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image_rec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get an image from a GLF file using the given record</span>

<span class="sd">    Args:</span>
<span class="sd">        gpath (str): path to a single GLF file.</span>
<span class="sd">        image_rec (ImageRecord): the GLF File image record</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tuple[bytes, Tuple[int, int]]: raw data as bytes and the width and height in pixels as ints.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - as nice as it is to wrap the GLF path here, this means a double</span>
    <span class="c1"># open often, as glf_get_image can be inside a loop with glf_times_range above</span>
    <span class="c1"># Might need to think about how these two functions are used together.</span>
    <span class="c1"># It&#39;s also a small function so maybe there&#39;s a better way?</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">GLF</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">gf</span><span class="p">:</span>
            <span class="n">image_data</span><span class="p">,</span> <span class="n">image_size</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">extract_image</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">image_size</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;_glf_times failed to read glf: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">gpath</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.glf_times_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">glf_times_range</span><span class="p">(</span><span class="n">gpath</span><span class="p">,</span> <span class="n">start_t</span><span class="p">,</span> <span class="n">end_t</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a path to a GLF file, and a start and end time, return an img record and 
the sonar range. This is an iterator function.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>gpath</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>path to a single GLF file.</p>
              </div>
            </li>
            <li>
              <b><code>start_t</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>the start datetime.</p>
              </div>
            </li>
            <li>
              <b><code>end_t</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>the end datetime.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="pytritech.image.ImageRecord">ImageRecord</span>, float]</code>
              –
              <div class="doc-md-description">
                <p>Union[Tuple[datetime.datetime, datetime.datetime], None]: either the start and end times, or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">glf_times_range</span><span class="p">(</span><span class="n">gpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_t</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">end_t</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ImageRecord</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a path to a GLF file, and a start and end time, return an img record and </span>
<span class="sd">    the sonar range. This is an iterator function.</span>

<span class="sd">    Args:</span>
<span class="sd">        gpath (str): path to a single GLF file.</span>
<span class="sd">        start_t (datetime.datetime): the start datetime.</span>
<span class="sd">        end_t (datetime.datetime): the end datetime.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Union[Tuple[datetime.datetime, datetime.datetime], None]: either the start and end times, or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO - I wonder if this could be made faster with a time index?</span>
    <span class="c1"># Also, yielding from within a with statement might mean a lot of opening and closing? Or maybe not?</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">GLF</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">gf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">image_rec</span> <span class="ow">in</span> <span class="n">gf</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
                <span class="n">image_time</span> <span class="o">=</span> <span class="n">image_rec</span><span class="o">.</span><span class="n">db_tx_time</span>

                <span class="k">if</span> <span class="n">image_time</span> <span class="o">&gt;=</span> <span class="n">start_t</span> <span class="ow">and</span> <span class="n">image_time</span> <span class="o">&lt;=</span> <span class="n">end_t</span><span class="p">:</span>
                    <span class="n">sonar_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">calculate_range</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)))</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">image_rec</span><span class="p">,</span> <span class="n">sonar_range</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;_glf_times failed to read glf: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">gpath</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">IOError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.has_track" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_track</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">image_time</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Look in the database to see if this image has a track.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>current SQLAlchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>image_time</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>the datetime of the current image.</p>
              </div>
            </li>
            <li>
              <b><code>sonar_id</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the sonar id.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code>bool</code>
)              –
              <div class="doc-md-description">
                <p>does this image have a track</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_track</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">image_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Look in the database to see if this image has a track.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): current SQLAlchemy session.</span>
<span class="sd">        image_time (datetime.datetime): the datetime of the current image.</span>
<span class="sd">        sonar_id (int): the sonar id.</span>

<span class="sd">    Returns:</span>
<span class="sd">       bool: does this image have a track</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">milliseconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">Points</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">image_time</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">Points</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">image_time</span> <span class="o">+</span> <span class="n">delta</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">sonarid</span> <span class="o">==</span> <span class="n">sonar_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.process_glf_by_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_glf_by_group</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">fname_lookup</span><span class="p">,</span> <span class="n">gdats</span><span class="p">,</span> <span class="n">max_glf</span><span class="p">,</span> <span class="n">outpath</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Process a single group, outputting all of the images from both sonars for the
time period of this group. fname_lookup is altered by the function, storing the new
image objects by the filename.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>the current SQLAlchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code><span title="sealhits.db.dbschema.Groups">Groups</span></code>)
              –
              <div class="doc-md-description">
                <p>the Group we are currently looking at.</p>
              </div>
            </li>
            <li>
              <b><code>fname_lookup</code></b>
                  (<code>dict</code>)
              –
              <div class="doc-md-description">
                <p>a lookup of images by filename. Can be an empty dict.</p>
              </div>
            </li>
            <li>
              <b><code>gdats</code></b>
                  (<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.sources.glf.GDat" href="#sealhits.sources.glf.GDat">GDat</a>]</code>)
              –
              <div class="doc-md-description">
                <p>a list of GDat objects.</p>
              </div>
            </li>
            <li>
              <b><code>max_glf</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the maximum number of images to consider.</p>
              </div>
            </li>
            <li>
              <b><code>outpath</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>where to save the output images.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Images">Images</span>], dict]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[List[Images], dict]: A list of the new Images objects created and the dict mapping filenames onto these images objects.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_glf_by_group</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">Groups</span><span class="p">,</span> <span class="n">fname_lookup</span><span class="p">,</span> <span class="n">gdats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">GDat</span><span class="p">],</span> <span class="n">max_glf</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">outpath</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Images</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a single group, outputting all of the images from both sonars for the</span>
<span class="sd">    time period of this group. fname_lookup is altered by the function, storing the new</span>
<span class="sd">    image objects by the filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): the current SQLAlchemy session.</span>
<span class="sd">        group (Groups): the Group we are currently looking at.</span>
<span class="sd">        fname_lookup (dict):  a lookup of images by filename. Can be an empty dict.</span>
<span class="sd">        gdats (List[GDat]): a list of GDat objects.</span>
<span class="sd">        max_glf (int): the maximum number of images to consider.</span>
<span class="sd">        outpath (str): where to save the output images.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tuple[List[Images], dict]: A list of the new Images objects created and the dict mapping filenames onto these images objects.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">group_start</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">timestart</span>
    <span class="n">group_end</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">timeend</span>
    <span class="n">group_image_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">new_images</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># We need a check here on the length of the group as there are some erroneous</span>
    <span class="c1"># SUPER long groups we can&#39;t ingest really. Anything longer than 2 minutes ignore</span>
    <span class="c1"># TODO - could potentialy ingest *up-to* this seconds amount?</span>
    <span class="n">gdd</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">timeend</span> <span class="o">-</span> <span class="n">group</span><span class="o">.</span><span class="n">timestart</span>

    <span class="k">if</span> <span class="n">gdd</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_glf</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Group </span><span class="si">%s</span><span class="s2"> is much too long with a time of </span><span class="si">%s</span><span class="s2"> seconds.&quot;</span><span class="p">,</span>
            <span class="n">group</span><span class="o">.</span><span class="n">huid</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">gdd</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_images</span><span class="p">,</span> <span class="n">fname_lookup</span>  <span class="c1"># Empty at this point</span>

    <span class="n">found_gdat</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">gdat</span> <span class="ow">in</span> <span class="n">gdats</span><span class="p">:</span>
        <span class="n">glfname</span> <span class="o">=</span> <span class="n">gdat</span><span class="o">.</span><span class="n">gobj</span><span class="o">.</span><span class="n">filename</span>

        <span class="c1"># If our start is greater, we&#39;ve already passed it as gdats is ordered.</span>
        <span class="c1"># probably doesn&#39;t save us too much time.</span>
        <span class="k">if</span> <span class="n">gdat</span><span class="o">.</span><span class="n">start_date</span> <span class="o">&gt;</span> <span class="n">group_end</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="n">group_start</span> <span class="o">&lt;=</span> <span class="n">gdat</span><span class="o">.</span><span class="n">end_date</span> <span class="ow">and</span> <span class="n">group_end</span> <span class="o">&gt;=</span> <span class="n">gdat</span><span class="o">.</span><span class="n">start_date</span><span class="p">:</span>
            <span class="c1"># Link GLF to group.</span>
            <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
                <span class="c1"># Check it doesn&#39;t exist already as sometimes we get duplicates</span>
                <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gdat</span><span class="o">.</span><span class="n">gobj</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
                    <span class="n">gdat</span><span class="o">.</span><span class="n">gobj</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

            <span class="c1"># Now fully read in the GLF</span>
            <span class="c1"># We read one frame at a time because it will use a lot of memory</span>
            <span class="c1"># TODO - could we check to see if the FITS already exists BEFORE the call to _glf_times?</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">image_rec</span><span class="p">,</span> <span class="n">srange</span> <span class="ow">in</span> <span class="n">glf_times_range</span><span class="p">(</span>
                    <span class="n">gdat</span><span class="o">.</span><span class="n">full_path</span><span class="p">,</span> <span class="n">group_start</span><span class="p">,</span> <span class="n">group_end</span>
                <span class="p">):</span>
                    <span class="n">found_gdat</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">image_time</span> <span class="o">=</span> <span class="n">image_rec</span><span class="o">.</span><span class="n">db_tx_time</span>
                    <span class="n">sonar_id</span> <span class="o">=</span> <span class="n">image_rec</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">device_id</span>
                    <span class="n">milli</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image_time</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
                    <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.fits&quot;</span>

                    <span class="c1"># Setup the FITS filename; a combination of time and sonar id.</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">image_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_&quot;</span><span class="p">)</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">milli</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sonar_id</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">ext</span>
                    <span class="p">)</span>

                    <span class="n">fname_compressed</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;.lz4&quot;</span>
                    <span class="n">subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">image_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">subdir</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span>

                    <span class="c1"># Check to see if this image already exists. It might if groups overlap</span>
                    <span class="n">full_fits_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span> <span class="n">fname_compressed</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">full_fits_path</span><span class="p">):</span>
                        <span class="c1"># TODO - remove this I think or fire up an error to ignore this GLF</span>
                        <span class="c1"># as looping around is not ideal!</span>
                        <span class="c1"># For some reason, this can fail too but the file seems fine.</span>
                        <span class="c1"># Therefore, we should loop around again till it reads correctly</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="n">glf_get_image</span><span class="p">(</span><span class="n">gdat</span><span class="o">.</span><span class="n">full_path</span><span class="p">,</span> <span class="n">image_rec</span><span class="p">)</span>
                        <span class="n">image_data</span><span class="p">,</span> <span class="n">image_size</span> <span class="o">=</span> <span class="n">res</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">image_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="p">)</span>

                            <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;SONARID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sonar_id</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;WIDTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;HEIGHT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">year</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;MONTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">month</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;DAY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">day</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;HOUR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">hour</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;MINUTE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">minute</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;SECOND&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_time</span><span class="o">.</span><span class="n">second</span>
                            <span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;MILLI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image_time</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
                            <span class="c1"># hdr = fits.PrimaryHDU(image_np, header=hdr)</span>
                            <span class="c1"># hdul = fits.HDUList([hdr])</span>
                            <span class="c1"># hdul.writeto(full_fits_path)</span>
                            <span class="n">compress</span><span class="p">(</span><span class="n">image_np</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span> <span class="n">full_fits_path</span><span class="p">)</span>

                            <span class="k">del</span> <span class="n">image_data</span>
                            <span class="k">del</span> <span class="n">image_np</span>
                            <span class="k">del</span> <span class="n">hdr</span>

                            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="s2">&quot;Generated </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">full_fits_path</span><span class="p">,</span> <span class="n">gdat</span><span class="o">.</span><span class="n">full_path</span>
                            <span class="p">)</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="s2">&quot;Could not generate FITS: </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">fname</span><span class="p">,</span>
                                <span class="n">e</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Traceback </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

                    <span class="c1"># else:</span>
                    <span class="c1">#    logging.info(&quot;File %s already exists for group %s&quot;, full_fits_path, group.huid)</span>

                    <span class="c1"># Now create the DB objects. We create new image objects, or</span>
                    <span class="c1"># we find the existing one and modify it. We return all images</span>
                    <span class="c1"># and hope our transaction does the right thing in adding or</span>
                    <span class="c1"># updating.</span>
                    <span class="n">group_image_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">new_image</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
                        <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Images</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Images</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">fname</span><span class="p">)</span>
                        <span class="n">new_image</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

                    <span class="c1"># It&#39;s also possible that we already have this image ready to be committed to the</span>
                    <span class="c1"># DB but it gets pulled in again for a different group so we must check</span>
                    <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fname_lookup</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">new_image</span> <span class="o">=</span> <span class="n">fname_lookup</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">new_image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ht</span> <span class="o">=</span> <span class="n">has_track</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">image_time</span><span class="p">,</span> <span class="n">sonar_id</span><span class="p">)</span>

                        <span class="n">new_image</span> <span class="o">=</span> <span class="n">Images</span><span class="p">(</span>
                            <span class="n">uid</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">(),</span>
                            <span class="n">filename</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span>
                            <span class="n">hastrack</span><span class="o">=</span><span class="n">ht</span><span class="p">,</span>
                            <span class="n">glf</span><span class="o">=</span><span class="n">glfname</span><span class="p">,</span>
                            <span class="n">time</span><span class="o">=</span><span class="n">image_time</span><span class="p">,</span>
                            <span class="n">sonarid</span><span class="o">=</span><span class="n">sonar_id</span><span class="p">,</span>
                            <span class="nb">range</span><span class="o">=</span><span class="n">srange</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="n">fname_lookup</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_image</span>

                    <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_image</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
                        <span class="n">new_image</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

                    <span class="n">new_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_image</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Failed to read GLF </span><span class="si">%s</span><span class="s2">. Skipping...&quot;</span><span class="p">,</span> <span class="n">glfname</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_gdat</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Found no GDATS for group </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">huid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">group_image_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;*** Group </span><span class="si">%s</span><span class="s2"> has no images! ***&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">huid</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_images</span><span class="p">,</span> <span class="n">fname_lookup</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.process_glfs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_glfs</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">glfpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">,</span> <span class="n">max_glf</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Once the PGDFs and SQLITE are processed, we can
begin to look for the GLF files we need. We want each new group
to have a number of FITS images fitting the range timestart - buffer
to time-end + buffer.
The function split_groups will have split groups and adjusted start and
end times already so we judt need to look at the group times.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>the current SQLAlchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>groups</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>)
              –
              <div class="doc-md-description">
                <p>the Groups we are currently looking at.</p>
              </div>
            </li>
            <li>
              <b><code>glfpath</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the path to the GLF fules</p>
              </div>
            </li>
            <li>
              <b><code>max_glf</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the maximum number of images to consider.</p>
              </div>
            </li>
            <li>
              <b><code>outpath</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>where to save the output images.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.GLFS">GLFS</span>], <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Images">Images</span>]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[List[GLFS], List[Images]]: Two lists - the new GLFS objects to save to the DB and the new Images objects to save to the DB.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_glfs</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">],</span> <span class="n">glfpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">outpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_glf</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">GLFS</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Images</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Once the PGDFs and SQLITE are processed, we can</span>
<span class="sd">    begin to look for the GLF files we need. We want each new group</span>
<span class="sd">    to have a number of FITS images fitting the range timestart - buffer</span>
<span class="sd">    to time-end + buffer.</span>
<span class="sd">    The function split_groups will have split groups and adjusted start and</span>
<span class="sd">    end times already so we judt need to look at the group times.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): the current SQLAlchemy session.</span>
<span class="sd">        groups (List[Groups]): the Groups we are currently looking at.</span>
<span class="sd">        glfpath (str): the path to the GLF fules</span>
<span class="sd">        max_glf (int): the maximum number of images to consider.</span>
<span class="sd">        outpath (str): where to save the output images.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tuple[List[GLFS], List[Images]]: Two lists - the new GLFS objects to save to the DB and the new Images objects to save to the DB.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_glfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding available GLF files...&quot;</span><span class="p">)</span>
    <span class="n">glf_files</span> <span class="o">=</span> <span class="n">glf_files_avail</span><span class="p">(</span><span class="n">glfpath</span><span class="p">)</span>

    <span class="c1"># Go through all GLFs and get the times of each.</span>
    <span class="c1"># Check the database first for the times we already have and</span>
    <span class="c1"># only grab the times for GLFs we don&#39;t have</span>
    <span class="c1"># There might be duplicates due to directory renaming or similar and rsync.</span>
    <span class="n">times</span><span class="p">,</span> <span class="n">glf_files_missing</span> <span class="o">=</span> <span class="n">_find_glf_times_db</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">glf_files</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieving GLF Times (this may take a while)...&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">glf_files_missing</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;GLFs missing from DB: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">glf_files_missing</span><span class="p">))</span>
        <span class="c1"># commented out due to errors on hdd5 for some reason?</span>
        <span class="c1"># with ThreadPool(NUM_THREADS) as pool:</span>
        <span class="c1"># times += pool.map(_get_glf_times, glf_files_missing, chunksize=NUM_THREADS)</span>
        <span class="k">for</span> <span class="n">glf_file</span> <span class="ow">in</span> <span class="n">glf_files_missing</span><span class="p">:</span>
            <span class="n">new_times</span> <span class="o">=</span> <span class="n">_get_glf_times</span><span class="p">(</span><span class="n">glf_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_times</span><span class="p">)</span>

    <span class="c1"># Add the GLFS regardless of whether or not they are used.</span>
    <span class="c1"># times_glfs is the list of all the info we need.</span>
    <span class="c1"># gdats are just a struct that holds the times, database</span>
    <span class="c1"># object and path together.</span>
    <span class="n">gdats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">glf_start</span><span class="p">,</span> <span class="n">glf_end</span><span class="p">),</span> <span class="n">glf_path</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
        <span class="n">glfname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">glf_path</span><span class="p">)</span>
        <span class="n">new_glf</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">GLFS</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">GLFS</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">glfname</span><span class="p">)</span>
            <span class="n">new_glf</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

        <span class="c1"># It&#39;s possible (for some reason) that GLFS might get double</span>
        <span class="c1"># counted in the addition phase, so make sure it doesn&#39;t exist</span>
        <span class="c1"># in the new_glfs already</span>
        <span class="k">for</span> <span class="n">ng</span> <span class="ow">in</span> <span class="n">new_glfs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ng</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">glfname</span><span class="p">:</span>
                <span class="n">new_glf</span> <span class="o">=</span> <span class="n">ng</span>

        <span class="k">if</span> <span class="n">new_glf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_glf</span> <span class="o">=</span> <span class="n">GLFS</span><span class="p">(</span>
                <span class="n">uid</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">(),</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">glfname</span><span class="p">,</span>
                <span class="n">startdate</span><span class="o">=</span><span class="n">glf_start</span><span class="p">,</span>
                <span class="n">enddate</span><span class="o">=</span><span class="n">glf_end</span><span class="p">,</span>
                <span class="n">groups</span><span class="o">=</span><span class="p">[],</span>
            <span class="p">)</span>

        <span class="n">new_glfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_glf</span><span class="p">)</span>
        <span class="n">gdats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GDat</span><span class="p">(</span><span class="n">glf_start</span><span class="p">,</span> <span class="n">glf_end</span><span class="p">,</span> <span class="n">new_glf</span><span class="p">,</span> <span class="n">glf_path</span><span class="p">))</span>

    <span class="c1"># Make sure there are no errored entries and organise by time</span>
    <span class="c1"># Sorting by time makes the FITS export a little quicker.</span>
    <span class="n">gdats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gdats</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">sort_times</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Number of initial time ranges: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdats</span><span class="p">))</span>
    <span class="n">gdat_latest</span> <span class="o">=</span> <span class="n">gdats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span>

    <span class="k">for</span> <span class="n">gd</span> <span class="ow">in</span> <span class="n">gdats</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gd</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&gt;</span> <span class="n">gdat_latest</span><span class="p">:</span>
            <span class="n">gdat_latest</span> <span class="o">=</span> <span class="n">gd</span><span class="o">.</span><span class="n">end_date</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;GDats earliest </span><span class="si">%s</span><span class="s2"> and latest </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">gdats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">gdat_latest</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">sofar</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Number of groups: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>

    <span class="c1"># The goal at this stage is to match up new group times with GLF times</span>
    <span class="c1"># and only process the files we need to, even if we&#39;ve recorded a whole</span>
    <span class="c1"># batch of GLFs for a time period.</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">sort_times_group</span><span class="p">))</span>
    <span class="n">group_earliest</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timestart</span>
    <span class="n">group_latest</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timeend</span>

    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">timeend</span> <span class="o">&gt;</span> <span class="n">group_latest</span><span class="p">:</span>
            <span class="n">group_latest</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">timeend</span>

    <span class="k">assert</span> <span class="n">group_earliest</span> <span class="o">&lt;</span> <span class="n">group_latest</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Groups earliest </span><span class="si">%s</span><span class="s2"> and latest </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_earliest</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_latest</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">new_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_images_by_fname</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Fast lookup</span>

    <span class="c1"># Start off the threads, chunking up the IDs then submitting to the threaded function.</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tlist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">NUM_THREADS</span><span class="p">:</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">ni</span><span class="p">,</span> <span class="n">nf</span> <span class="o">=</span> <span class="n">process_glf_by_group</span><span class="p">(</span>
                <span class="n">session</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">new_images_by_fname</span><span class="p">,</span> <span class="n">gdats</span><span class="p">,</span> <span class="n">max_glf</span><span class="p">,</span> <span class="n">outpath</span>
            <span class="p">)</span>
            <span class="n">new_images</span> <span class="o">+=</span> <span class="n">ni</span>
            <span class="n">new_images_by_fname</span> <span class="o">=</span> <span class="n">nf</span>

        <span class="n">sofar</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tlist</span><span class="p">)</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processed </span><span class="si">%s</span><span class="s2">. </span><span class="si">%s</span><span class="s2"> remaining.&quot;</span><span class="p">,</span> <span class="n">sofar</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">new_glfs</span><span class="p">,</span> <span class="n">new_images</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.sort_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_times</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Sort GDat by start date</p>

            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sort_times</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sort GDat by start date&quot;&quot;&quot;</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">start_date</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">start_date</span>

    <span class="k">if</span> <span class="n">s0</span> <span class="o">&lt;</span> <span class="n">s1</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="n">s0</span> <span class="o">==</span> <span class="n">s1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glf.sort_times_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_times_group</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Sort Groups by time start</p>

            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sort_times_group</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="s2">&quot;Sort Groups by time start&quot;</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">timestart</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">timestart</span>

    <span class="k">if</span> <span class="n">s0</span> <span class="o">&lt;</span> <span class="n">s1</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="n">s0</span> <span class="o">==</span> <span class="n">s1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="extraction-from-glfs">Extraction from GLFs</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.sources.glfextract"></a>
    <div class="doc doc-contents first">

      <p>glfextract.py - extract numpy arrays from GLF files.</p>
<p>A short utility function to extract numpy arrays
from a GLF file within a particular time range.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.glfextract.extract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract</span><span class="p">(</span><span class="n">gpath</span><span class="p">,</span> <span class="n">start_t</span><span class="p">,</span> <span class="n">end_t</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Given a path to a GLF file, a start and end time, return a 3D numpy
array of images within that time frame.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>gpath</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The path to a GLF file.</p>
              </div>
            </li>
            <li>
              <b><code>start_t</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>The starting date time.</p>
              </div>
            </li>
            <li>
              <b><code>end_t</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>The ending date time.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[None, <span title="numpy.array">array</span>]</code>
              –
              <div class="doc-md-description">
                <p>Union[None, np.array]: either None, or an np.array of frames</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/glfextract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">gpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_t</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">end_t</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a path to a GLF file, a start and end time, return a 3D numpy</span>
<span class="sd">    array of images within that time frame.</span>

<span class="sd">    Args:</span>
<span class="sd">        gpath (str): The path to a GLF file.</span>
<span class="sd">        start_t (datetime.datetime): The starting date time.</span>
<span class="sd">        end_t (datetime.datetime): The ending date time.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[None, np.array]: either None, or an np.array of frames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">GLF</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">gf</span><span class="p">:</span>
            <span class="n">time_start</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">time_end</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">image_rec</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">images</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Ingesting Images&quot;</span><span class="p">):</span>
                <span class="n">image_time</span> <span class="o">=</span> <span class="n">image_rec</span><span class="o">.</span><span class="n">db_tx_time</span>

                <span class="k">if</span> <span class="n">time_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">time_start</span> <span class="o">=</span> <span class="n">image_time</span>
                <span class="k">elif</span> <span class="n">image_time</span> <span class="o">&lt;</span> <span class="n">time_start</span><span class="p">:</span>
                    <span class="n">time_start</span> <span class="o">=</span> <span class="n">image_time</span>

                <span class="k">if</span> <span class="n">time_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">time_end</span> <span class="o">=</span> <span class="n">image_time</span>
                <span class="k">elif</span> <span class="n">image_time</span> <span class="o">&gt;</span> <span class="n">time_end</span><span class="p">:</span>
                    <span class="n">time_end</span> <span class="o">=</span> <span class="n">image_time</span>

                <span class="k">if</span> <span class="n">image_time</span> <span class="o">&gt;=</span> <span class="n">start_t</span> <span class="ow">and</span> <span class="n">image_time</span> <span class="o">&lt;=</span> <span class="n">end_t</span><span class="p">:</span>
                    <span class="n">image_data</span><span class="p">,</span> <span class="n">image_size</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">extract_image</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>
                    <span class="n">image_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                        <span class="n">image_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

                    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_np</span><span class="p">)</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">frames</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="ingesting-groups">Ingesting Groups</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.sources.group"></a>
    <div class="doc doc-contents first">

      <p>group.py - group object functions</p>
<p>Functions for sorting out group objects, such as fixing the times
and splitting based on a buffer time.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.group.find_group_objects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_group_objects</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">sqldb</span><span class="p">,</span> <span class="n">sqlname</span><span class="p">,</span> <span class="n">sqlalias</span><span class="p">,</span> <span class="n">max_secs</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Start by finding the Groups and TrackGroups from the
SQLITE file and creating these in memory.</p>
<p>sqlalias is required in case one is reading in an updated or otherwise changed sqlitefile
that has a different name. Groups will exist from this previous version of the file and 
should be included. sqlalias should be set to the name of that older file. Otherwise, alias
should match sqlname.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>The current SQLAlchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>sqldb</code></b>
                  (<code>SQLPAM</code>)
              –
              <div class="doc-md-description">
                <p>The SQLPAM database object we are reading.</p>
              </div>
            </li>
            <li>
              <b><code>sqlname</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename of the sqlite file.</p>
              </div>
            </li>
            <li>
              <b><code>sqlalias</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>If we are reading from a different sqlite file but want to lookup with an alias, add a different name here.</p>
              </div>
            </li>
            <li>
              <b><code>max_secs</code></b>
                  (<code>int</code>, default:
                      <code>800</code>
)
              –
              <div class="doc-md-description">
                <p>The maximum length of group to consider in seconds.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>], <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.db.dbschema.TrackGroup" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[List[Groups], List[TrackGroup]]: Two lists, the new Groups objects and the TrackGroup objects.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/group.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_group_objects</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sqldb</span><span class="p">:</span> <span class="n">sqlpam</span><span class="o">.</span><span class="n">SQLPAM</span><span class="p">,</span> <span class="n">sqlname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sqlalias</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_secs</span><span class="o">=</span><span class="mi">800</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">TrackGroup</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start by finding the Groups and TrackGroups from the</span>
<span class="sd">    SQLITE file and creating these in memory.</span>

<span class="sd">    sqlalias is required in case one is reading in an updated or otherwise changed sqlitefile</span>
<span class="sd">    that has a different name. Groups will exist from this previous version of the file and </span>
<span class="sd">    should be included. sqlalias should be set to the name of that older file. Otherwise, alias</span>
<span class="sd">    should match sqlname.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): The current SQLAlchemy session.</span>
<span class="sd">        sqldb (SQLPAM): The SQLPAM database object we are reading.</span>
<span class="sd">        sqlname (str): The filename of the sqlite file.</span>
<span class="sd">        sqlalias (str): If we are reading from a different sqlite file but want to lookup with an alias, add a different name here.</span>
<span class="sd">        max_secs (int): The maximum length of group to consider in seconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Tuple[List[Groups], List[TrackGroup]]: Two lists, the new Groups objects and the TrackGroup objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group_list</span> <span class="o">=</span> <span class="n">sqldb</span><span class="o">.</span><span class="n">track_groups</span>
    <span class="n">found_groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_tracks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading Groups...&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">group_list</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Reading Groups&quot;</span><span class="p">):</span>
        <span class="n">interaction</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">interaction</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">track_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">track_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Start with the master group object</span>
        <span class="c1"># Check the *real* composite primary key. If it exists,</span>
        <span class="c1"># return that instead of a new thing. Means we can use</span>
        <span class="c1"># merge later on to do easy updates.</span>
        <span class="c1"># split can be -1 or 0. If it&#39;s not been split or it&#39;s been split and it&#39;s the first one.</span>
        <span class="n">new_group</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">Groups</span><span class="o">.</span><span class="n">gid</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                <span class="n">Groups</span><span class="o">.</span><span class="n">sqliteid</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">or_</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">split</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Groups</span><span class="o">.</span><span class="n">split</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">==</span> <span class="n">sqlalias</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">new_group</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">new_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">huid</span> <span class="o">=</span> <span class="n">generate_id</span><span class="p">()</span>
            <span class="n">new_group</span> <span class="o">=</span> <span class="n">Groups</span><span class="p">(</span>
                <span class="n">uid</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">(),</span>
                <span class="n">gid</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                <span class="n">sqliteid</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">sqlite</span><span class="o">=</span><span class="n">sqlname</span><span class="p">,</span>
                <span class="n">huid</span><span class="o">=</span><span class="n">huid</span><span class="p">,</span>
                <span class="n">timestart</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">utc</span><span class="p">,</span>
                <span class="n">timeend</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
                <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span>
                <span class="n">comment</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
                <span class="n">mammal</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">mammal</span><span class="p">,</span>
                <span class="n">fish</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">fish</span><span class="p">,</span>
                <span class="n">bird</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">bird</span><span class="p">,</span>
                <span class="n">interact</span><span class="o">=</span><span class="n">interaction</span><span class="p">,</span>
                <span class="n">split</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">pgdfs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">images</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">glfs</span><span class="o">=</span><span class="p">[],</span>
            <span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New Group: </span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sqlname</span><span class="p">,</span> <span class="n">huid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check to see if this group needs updating</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">timestart</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">utc</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">timeend</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">end_time</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">comment</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">mammal</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">mammal</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">fish</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">fish</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">bird</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">bird</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">interact</span> <span class="o">=</span> <span class="n">interaction</span>
            <span class="c1"># We may need to change the sqlname which is part of the composite key</span>
            <span class="c1"># We set it to the new SQLITEDB we are importing.</span>
            <span class="n">new_group</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">=</span> <span class="n">sqlname</span>

        <span class="c1"># Early rejection of groups that are too long. Note that due to bugs in PAMGuard</span>
        <span class="c1"># the group times may not be accurate. However, we reject here so that the tracks</span>
        <span class="c1"># are also not included. TODO - this could be improved.</span>
        <span class="n">td</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">max_secs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_group</span><span class="o">.</span><span class="n">timeend</span> <span class="o">-</span> <span class="n">new_group</span><span class="o">.</span><span class="n">timestart</span> <span class="o">&gt;</span> <span class="n">td</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> Group that exceed </span><span class="si">%d</span><span class="s2"> seconds! Not including!&quot;</span><span class="p">,</span> <span class="n">new_group</span><span class="o">.</span><span class="n">huid</span><span class="p">,</span> <span class="n">max_secs</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Now Look at the track children - this links to the</span>
        <span class="c1"># PGDFs we are interested in.</span>
        <span class="c1"># We also add the track_id to the tracks_groups table</span>
        <span class="c1"># using our own UUID instead of the gids</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">binary_file</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">binary_file</span>
            <span class="c1"># Make sure the binary file is a single filename</span>
            <span class="c1"># with the pgdf extension</span>
            <span class="n">binary_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">binary_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">binary_file</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">!=</span> <span class="s2">&quot;.pgdf&quot;</span><span class="p">:</span>
                <span class="n">binary_file</span> <span class="o">+=</span> <span class="s2">&quot;.pgdf&quot;</span>

            <span class="n">new_track</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">TrackGroup</span><span class="o">.</span><span class="n">track_pam_id</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                    <span class="c1">#TrackGroup.group_id == new_group.uid, # Commented as it&#39;s pam and binary that are unique identifiers before we add uids</span>
                    <span class="n">TrackGroup</span><span class="o">.</span><span class="n">binfile</span> <span class="o">==</span> <span class="n">binary_file</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">new_track</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">new_track</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_track</span> <span class="o">=</span> <span class="n">TrackGroup</span><span class="p">(</span>
                    <span class="n">track_id</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">(),</span>
                    <span class="n">track_pam_id</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                    <span class="n">group_id</span><span class="o">=</span><span class="n">new_group</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                    <span class="n">binfile</span><span class="o">=</span><span class="n">binary_file</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># update the new trackgroup with latest</span>
                <span class="n">new_track</span><span class="o">.</span><span class="n">track_pam_id</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">uid</span>
                <span class="n">new_track</span><span class="o">.</span><span class="n">binfile</span> <span class="o">=</span> <span class="n">binary_file</span>

            <span class="n">found_tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_track</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_tracks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">found_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_group</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> Group with 0 tracks! Not including!&quot;</span><span class="p">,</span> <span class="n">new_group</span><span class="o">.</span><span class="n">huid</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> Groups and </span><span class="si">%d</span><span class="s2"> Tracks.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_groups</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_tracks</span><span class="p">))</span>

    <span class="n">earliest</span> <span class="o">=</span> <span class="n">found_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timestart</span>
    <span class="n">latest</span> <span class="o">=</span> <span class="n">found_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timeend</span>

    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">found_groups</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">timestart</span> <span class="o">&lt;</span> <span class="n">earliest</span><span class="p">:</span>
            <span class="n">earliest</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">timestart</span>

        <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">timeend</span> <span class="o">&lt;</span> <span class="n">earliest</span><span class="p">:</span>
            <span class="n">latest</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">timeend</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> Groups and </span><span class="si">%s</span><span class="s2"> Tracks.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">earliest</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">latest</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">found_groups</span><span class="p">,</span> <span class="n">found_tracks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.group.fix_group_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fix_group_times</span><span class="p">(</span><span class="n">new_groups</span><span class="p">,</span> <span class="n">new_points</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>PAMGuard SQLITE file reports incorrect group times. We therefore
look at all the tracks and find the earliest and latest times and
set the group times to match these.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>new_groups</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The latest groups we want to split.</p>
              </div>
            </li>
            <li>
              <b><code>new_points</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The latest points we want to re-assign.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[Groups]: The corrected groups.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/group.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fix_group_times</span><span class="p">(</span><span class="n">new_groups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">],</span> <span class="n">new_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PAMGuard SQLITE file reports incorrect group times. We therefore</span>
<span class="sd">    look at all the tracks and find the earliest and latest times and</span>
<span class="sd">    set the group times to match these.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_groups (List[Groups]): The latest groups we want to split.</span>
<span class="sd">        new_points (List[Points]): The latest points we want to re-assign.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Groups]: The corrected groups.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fixing group times...&quot;</span><span class="p">)</span>
    <span class="n">fixed_groups</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">new_groups</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Groups fixed&quot;</span><span class="p">):</span>
        <span class="n">min_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>

        <span class="c1"># Check to see if we have points directly on this group</span>
        <span class="c1"># if we do then we can use these as the groups is</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">new_points</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span><span class="p">:</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">min_time</span><span class="p">:</span>
                    <span class="n">min_time</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">time</span>

                <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">max_time</span><span class="p">:</span>
                    <span class="n">max_time</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">time</span>

        <span class="n">group</span><span class="o">.</span><span class="n">timestart</span> <span class="o">=</span> <span class="n">min_time</span>
        <span class="n">group</span><span class="o">.</span><span class="n">timeend</span> <span class="o">=</span> <span class="n">max_time</span>
        <span class="n">fixed_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fixed_groups</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.group.split_groups" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_groups</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">new_groups</span><span class="p">,</span> <span class="n">new_points</span><span class="p">,</span> <span class="n">buffer_gap</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>It is possible that some groups may have large gaps with no
tracks. Such groups need to be split, creating new groups .
This function returns a new list of all the groups including the
original groups and the new splits, and the changed points.</p>
<p>Split groups also buffers all groups including these that are not
split, so each group has a blank area before and after it.</p>
<p>TrackGroups are not changed. These are mostly irrelevant and are
there to make matching up the original points to the original group
easier. The group_id on the Point will point to the new group post
split.</p>
<p>Split groups also checks where the true start and end of the groups
are as occasionally, some groups start earlier or finish later than
the actual tracks for some reason.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>The current SQLAlchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>new_groups</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The latest groups we want to split.</p>
              </div>
            </li>
            <li>
              <b><code>new_points</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The latest points we want to re-assign.</p>
              </div>
            </li>
            <li>
              <b><code>buffer_gap</code></b>
                  (<code>int</code>, default:
                      <code>4</code>
)
              –
              <div class="doc-md-description">
                <p>The number of seconds for the start and end buffer. Also, the minimum gap between points in a track before we split.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>], <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[List[Groups], List[Points]]: The new_groups and new_point with the new split-off groups and reassigned points.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/group.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_groups</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">new_groups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">],</span> <span class="n">new_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">],</span> <span class="n">buffer_gap</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;It is possible that some groups may have large gaps with no</span>
<span class="sd">    tracks. Such groups need to be split, creating new groups .</span>
<span class="sd">    This function returns a new list of all the groups including the</span>
<span class="sd">    original groups and the new splits, and the changed points.</span>

<span class="sd">    Split groups also buffers all groups including these that are not</span>
<span class="sd">    split, so each group has a blank area before and after it.</span>

<span class="sd">    TrackGroups are not changed. These are mostly irrelevant and are</span>
<span class="sd">    there to make matching up the original points to the original group</span>
<span class="sd">    easier. The group_id on the Point will point to the new group post</span>
<span class="sd">    split.</span>

<span class="sd">    Split groups also checks where the true start and end of the groups</span>
<span class="sd">    are as occasionally, some groups start earlier or finish later than</span>
<span class="sd">    the actual tracks for some reason.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): The current SQLAlchemy session.</span>
<span class="sd">        new_groups (List[Groups]): The latest groups we want to split.</span>
<span class="sd">        new_points (List[Points]): The latest points we want to re-assign.</span>
<span class="sd">        buffer_gap (int): The number of seconds for the start and end buffer. Also, the minimum gap between points in a track before we split.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[Groups], List[Points]]: The new_groups and new_point with the new split-off groups and reassigned points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">return_groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">return_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">buffer_gap</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">new_groups</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Splitting new groups.&quot;</span><span class="p">):</span>
        <span class="c1"># Check to see if this group has already been split?</span>
        <span class="c1">#logging.info(&quot;Group split code %s %d&quot;, group.huid, group.split)</span>

        <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">split</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Group </span><span class="si">%s</span><span class="s2"> has already been split&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">huid</span><span class="p">)</span>
            <span class="c1"># This group has already been assessed so get all splits then continue</span>
            <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                        <span class="n">Groups</span><span class="o">.</span><span class="n">gid</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span>
                        <span class="n">Groups</span><span class="o">.</span><span class="n">sqliteid</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">sqliteid</span><span class="p">,</span>
                        <span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">sqlite</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">new_groups</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">group_two</span> <span class="ow">in</span> <span class="n">new_groups</span><span class="p">:</span>
                    <span class="n">return_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_two</span><span class="p">)</span>

                <span class="k">continue</span>

        <span class="c1"># It hasn&#39;t been split, so check if it needs to be</span>
        <span class="c1"># First, get all the points and their times from each track.</span>
        <span class="n">group_points</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">new_points</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span><span class="p">:</span>
                <span class="n">group_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="c1"># This should never happen but thanks to issues with data not where it should be</span>
        <span class="c1"># (disks 33 and 35) it does :/ Needs a fix at some point.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No points found on group </span><span class="si">%s</span><span class="s2"> in split attempt.&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">huid</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1">#assert len(group_points) &gt; 0</span>

        <span class="c1"># We need to order times, and points, tpamids into ascending order of time</span>
        <span class="n">group_points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">group_points</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

        <span class="c1"># Alter the start and end times of the groups to match the ones found</span>
        <span class="c1"># from the tracks. This is a &#39;belt-and-braces&#39; sort of check given the one</span>
        <span class="c1"># problem group found in riverseals.</span>
        <span class="n">new_group_start</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
        <span class="n">new_group_end</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>

        <span class="k">assert</span><span class="p">(</span><span class="n">new_group_start</span> <span class="o">&gt;=</span> <span class="n">group</span><span class="o">.</span><span class="n">timestart</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">new_group_end</span> <span class="o">&lt;=</span> <span class="n">group</span><span class="o">.</span><span class="n">timeend</span><span class="p">)</span>

        <span class="c1"># Splits will contain the indices on which to split the</span>
        <span class="c1"># points into new tracks and the groups into new groups.</span>
        <span class="c1"># Group splits are the new group uids we&#39;ve made.</span>
        <span class="n">splits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group_splits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Find the gaps and mark them up</span>
        <span class="k">for</span> <span class="n">tidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="n">tidx</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="n">tidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
            <span class="n">td</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>

            <span class="k">if</span> <span class="n">td</span> <span class="o">&gt;</span> <span class="n">buffer</span><span class="p">:</span>
                <span class="n">splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">group_time_end</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">timeend</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Redo the first group - setting it&#39;s time end to the correct one.</span>
            <span class="n">group_time_end</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
            <span class="n">group</span><span class="o">.</span><span class="n">timeend</span> <span class="o">=</span> <span class="n">group_time_end</span>
            <span class="n">group</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">group_splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

            <span class="c1"># Now create new groups with the same gid but new times</span>
            <span class="k">for</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">split</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">splits</span><span class="p">):</span>
                <span class="n">timestart</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
                <span class="n">timeend</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>  <span class="c1"># Set to the last time for now</span>

                <span class="k">if</span> <span class="n">sidx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">):</span>
                    <span class="n">timeend</span> <span class="o">=</span> <span class="n">group_points</span><span class="p">[</span><span class="n">splits</span><span class="p">[</span><span class="n">sidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>

                <span class="c1"># Add the buffer times for the new group</span>
                <span class="n">timestart</span> <span class="o">-=</span> <span class="n">buffer</span>
                <span class="n">timeend</span> <span class="o">+=</span> <span class="n">buffer</span>

                <span class="c1"># New group with new times. We keep the gid but use an incremented string for the sqlite filename</span>
                <span class="c1"># 0 in split is the original group (or parent group in this case) so we increment sidx by one as this new group is the &#39;first split&#39;</span>
                <span class="c1"># TODO - we keep the same PGDFs here but eventually we&#39;ll need to double check these</span>
                <span class="k">assert</span><span class="p">(</span><span class="n">timestart</span> <span class="o">&lt;</span> <span class="n">timeend</span><span class="p">)</span>
                <span class="n">new_group</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                        <span class="n">Groups</span><span class="o">.</span><span class="n">gid</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span>
                        <span class="n">Groups</span><span class="o">.</span><span class="n">sqliteid</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">sqliteid</span><span class="p">,</span>
                        <span class="n">Groups</span><span class="o">.</span><span class="n">split</span> <span class="o">==</span> <span class="n">sidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">sqlite</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">new_group</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">new_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new_group</span> <span class="o">=</span> <span class="n">Groups</span><span class="p">(</span>
                        <span class="n">uid</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">(),</span>
                        <span class="n">gid</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span>
                        <span class="n">sqliteid</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">sqliteid</span><span class="p">,</span>
                        <span class="n">timestart</span><span class="o">=</span><span class="n">timestart</span><span class="p">,</span>
                        <span class="n">timeend</span><span class="o">=</span><span class="n">timeend</span><span class="p">,</span>
                        <span class="n">sqlite</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">sqlite</span><span class="p">,</span>
                        <span class="n">code</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
                        <span class="n">comment</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
                        <span class="n">interact</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">interact</span><span class="p">,</span>
                        <span class="n">mammal</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">mammal</span><span class="p">,</span>
                        <span class="n">fish</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">fish</span><span class="p">,</span>
                        <span class="n">bird</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">bird</span><span class="p">,</span>
                        <span class="n">split</span><span class="o">=</span><span class="n">sidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">huid</span><span class="o">=</span><span class="n">generate_id</span><span class="p">(),</span>
                        <span class="n">pgdfs</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">pgdfs</span><span class="p">,</span>
                        <span class="n">images</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">glfs</span><span class="o">=</span><span class="p">[],</span>
                    <span class="p">)</span>

                <span class="k">assert</span><span class="p">(</span><span class="n">new_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">return_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_group</span><span class="p">)</span>
                <span class="n">group_splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_group</span><span class="p">)</span>

            <span class="c1"># We look at each point in turn, assigning it to a new group</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">group_points</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sgroup</span> <span class="ow">in</span> <span class="n">group_splits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">timestart</span> <span class="ow">and</span> <span class="n">point</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">timeend</span><span class="p">:</span>
                        <span class="n">point</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">uid</span>
                        <span class="k">break</span>

        <span class="n">return_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="c1"># Original group is always returned</span>
        <span class="n">return_points</span> <span class="o">+=</span> <span class="n">group_points</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">return_groups</span><span class="p">,</span> <span class="n">return_points</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="sources-model">Sources model</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.sources.model"></a>
    <div class="doc doc-contents first">

      <p>model.py - build a model from a current ingest.</p>
<p>Function for creating the current model of the data from
a particular sqlite import.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.model.build_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_model</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">sqlname</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>The goal is to build an existing model from the database
ready to compare with later. Anything in this model not in the new one
will need to be deleted.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>The current SQLAlchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>sqlname</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the name of the sqlite file we are attempting to model.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>], <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.db.dbschema.TrackGroup" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>], <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>], <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.PGDFS">PGDFS</span>], <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.GLFS">GLFS</span>], <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Images">Images</span>]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[List[Groups], List[TrackGroup], List[Points], List[PGDFS], List[GLFS], List[Images]]: Six lists of the major objects in the database model.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sqlname</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">TrackGroup</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">PGDFS</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">GLFS</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Images</span><span class="p">]</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The goal is to build an existing model from the database</span>
<span class="sd">    ready to compare with later. Anything in this model not in the new one</span>
<span class="sd">    will need to be deleted.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): The current SQLAlchemy session.</span>
<span class="sd">        sqlname (str): the name of the sqlite file we are attempting to model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[Groups], List[TrackGroup], List[Points], List[PGDFS], List[GLFS], List[Images]]: Six lists of the major objects in the database model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Groups</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Groups</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">==</span> <span class="n">sqlname</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># The following are all dependent on the groups above.</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pgdfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">glfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># TODO - must be a faster way?</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
        <span class="c1"># Tracks first</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TrackGroup</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">TrackGroup</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
            <span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># Now lookup points</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Points</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># pgdfs, glfs and images - just the ones attached to the group</span>
        <span class="n">pgdfs</span> <span class="o">+=</span> <span class="n">group</span><span class="o">.</span><span class="n">pgdfs</span>
        <span class="n">glfs</span> <span class="o">+=</span> <span class="n">group</span><span class="o">.</span><span class="n">glfs</span>
        <span class="n">images</span> <span class="o">+=</span> <span class="n">group</span><span class="o">.</span><span class="n">images</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">tracks</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">pgdfs</span><span class="p">,</span> <span class="n">glfs</span><span class="p">,</span> <span class="n">images</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="ingesting-pgdfs">Ingesting PGDFs</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.sources.pgdf"></a>
    <div class="doc doc-contents first">

      <p>model.py - build a model from a current ingest.</p>
<p>Functions for processing the PGDFs as part of the ingest.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.pgdf.process_pgdfs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_pgdfs</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">pgdf_path</span><span class="p">,</span> <span class="n">pgdfs</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tracks</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Build up the PGDFS, Points and groups_pgdfs tables
from the list of PGDFs provided.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>session</code></b>
                  (<code><span title="sqlalchemy.orm.Session">Session</span></code>)
              –
              <div class="doc-md-description">
                <p>The current SQLAlchemy session.</p>
              </div>
            </li>
            <li>
              <b><code>pgdf_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The path to the PGDFs.</p>
              </div>
            </li>
            <li>
              <b><code>pgdfs</code></b>
                  (<code><span title="typing.List">List</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>The list of PGDF files we want.</p>
              </div>
            </li>
            <li>
              <b><code>groups</code></b>
                  (<code><span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Groups">Groups</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The list of Groups from the current session.</p>
              </div>
            </li>
            <li>
              <b><code>tracks</code></b>
                  (<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.db.dbschema.TrackGroup" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>]</code>)
              –
              <div class="doc-md-description">
                <p>The list of TrackGroup in the current session.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="sealhits.db.dbschema.PGDFS">PGDFS</span>], <span title="typing.List">List</span>[<span title="sealhits.db.dbschema.Points">Points</span>]]</code>
              –
              <div class="doc-md-description">
                <p>Tuple[List[PGDFS], List[Points]]: The new PGDFS objects and the new Points objects.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/pgdf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_pgdfs</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span>
    <span class="n">pgdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pgdfs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">groups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Groups</span><span class="p">],</span>
    <span class="n">tracks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TrackGroup</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PGDFS</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Points</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build up the PGDFS, Points and groups_pgdfs tables</span>
<span class="sd">    from the list of PGDFs provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (Session): The current SQLAlchemy session.</span>
<span class="sd">        pgdf_path (str): The path to the PGDFs.</span>
<span class="sd">        pgdfs (List[str]): The list of PGDF files we want.</span>
<span class="sd">        groups (List[Groups]): The list of Groups from the current session.</span>
<span class="sd">        tracks (List[TrackGroup]): The list of TrackGroup in the current session.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[PGDFS], List[Points]]: The new PGDFS objects and the new Points objects.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - this should be a set of transactions that we apply to the db</span>
    <span class="c1"># so we don&#39;t muck things up if this process crashes.</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Process PGDFs starting...&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating pgdf -&gt; group...&quot;</span><span class="p">)</span>
    <span class="n">full_paths</span> <span class="o">=</span> <span class="n">pgdfs_to_full_paths</span><span class="p">(</span><span class="n">pgdf_path</span><span class="p">,</span> <span class="n">pgdfs</span><span class="p">)</span>
    <span class="n">new_pgdfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_points</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Read all the PGDFs to get the start &amp; end times</span>
    <span class="k">for</span> <span class="n">pgpath</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">full_paths</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Reading PGDFs&quot;</span><span class="p">):</span>
        <span class="n">fgname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pgpath</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">pgdf</span><span class="o">.</span><span class="n">PGDF</span><span class="p">(</span><span class="n">pgpath</span><span class="p">)</span>
        <span class="n">date_min</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">date_max</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">pamobj</span> <span class="ow">in</span> <span class="n">tp</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">tdate</span> <span class="o">=</span> <span class="n">pamobj</span><span class="o">.</span><span class="n">pam</span><span class="o">.</span><span class="n">date</span>
            <span class="k">assert</span> <span class="n">tdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">date_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">date_min</span> <span class="o">=</span> <span class="n">tdate</span>
            <span class="k">elif</span> <span class="n">date_min</span> <span class="o">&gt;</span> <span class="n">tdate</span><span class="p">:</span>
                <span class="n">date_min</span> <span class="o">=</span> <span class="n">tdate</span>

            <span class="k">if</span> <span class="n">date_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">date_max</span> <span class="o">=</span> <span class="n">tdate</span>
            <span class="k">elif</span> <span class="n">date_max</span> <span class="o">&lt;</span> <span class="n">tdate</span><span class="p">:</span>
                <span class="n">date_max</span> <span class="o">=</span> <span class="n">tdate</span>

        <span class="c1"># Find the tracks_groups for the groups and file we are currently processing</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating tracks lookup for file </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pgpath</span><span class="p">)</span>

        <span class="c1"># Create a second dictionary for fast checking of tracks_groups</span>
        <span class="c1"># Dictionaries have O(1) access time apparently. Hashtable like I bet.</span>
        <span class="n">tracks_used</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># We also don&#39;t use the pamguard id but a distinct-across-pgdf-files uid</span>
        <span class="c1"># of our own, so we need that lookup too.</span>
        <span class="n">track_pam_to_track</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">tg</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">track_pam_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracks_used</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">tracks_used</span><span class="p">[</span><span class="n">tg</span><span class="o">.</span><span class="n">track_pam_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">track_pam_to_track</span><span class="p">[</span><span class="n">tg</span><span class="o">.</span><span class="n">track_pam_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">tg</span>

        <span class="c1"># Create a PGDF and add it to the new list</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">PGDFS</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">PGDFS</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">fgname</span><span class="p">)</span>
        <span class="n">pgdf_entry</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pgdf_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pgdf_entry</span> <span class="o">=</span> <span class="n">PGDFS</span><span class="p">(</span>
                <span class="n">uid</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">(),</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">fgname</span><span class="p">,</span>
                <span class="n">startdate</span><span class="o">=</span><span class="n">date_min</span><span class="p">,</span>
                <span class="n">enddate</span><span class="o">=</span><span class="n">date_max</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update PGDF with new details</span>
            <span class="n">pgdf_entry</span><span class="o">.</span><span class="n">startdate</span> <span class="o">=</span> <span class="n">date_min</span><span class="p">,</span>
            <span class="n">pgdf_entry</span><span class="o">.</span><span class="n">enddate</span> <span class="o">=</span> <span class="n">date_max</span>

        <span class="n">new_pgdfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgdf_entry</span><span class="p">)</span>

        <span class="c1"># Now, we read the points in this PGDF but we must</span>
        <span class="c1"># only include these that reference the tracks_groups table.</span>
        <span class="c1"># We can safely assume the tracks table is not as stupidly</span>
        <span class="c1"># large as the number of annotations is small.</span>
        <span class="k">for</span> <span class="n">pamobj</span> <span class="ow">in</span> <span class="n">tp</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">pam_track</span> <span class="o">=</span> <span class="n">pamobj</span><span class="o">.</span><span class="n">data</span>
            <span class="n">pam_track_uid</span> <span class="o">=</span> <span class="n">pamobj</span><span class="o">.</span><span class="n">pam</span><span class="o">.</span><span class="n">UID</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">track</span> <span class="o">=</span> <span class="n">pam_track</span><span class="o">.</span><span class="n">track</span>
                <span class="n">track_obj</span> <span class="o">=</span> <span class="n">track_pam_to_track</span><span class="p">[</span><span class="n">pam_track_uid</span><span class="p">]</span>
                <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">track_obj</span><span class="o">.</span><span class="n">group_id</span><span class="p">:</span>
                        <span class="n">group</span> <span class="o">=</span> <span class="n">g</span>
                        <span class="k">break</span>
                <span class="c1"># Should never happen but apparently, HDD 35 and 33 are sort of</span>
                <span class="c1"># mixed. Not sure what happened here but we just log and ignore</span>
                <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Missing group </span><span class="si">%s</span><span class="s2"> for trackgroup on pgdf </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">track_obj</span><span class="o">.</span><span class="n">group_id</span><span class="p">,</span> <span class="n">fgname</span><span class="p">)</span>
                    <span class="k">break</span> 

                <span class="c1">#assert(group is not None)</span>

                <span class="c1"># Create the link between the group and pgdf if not already</span>
                <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pgdf_entry</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
                    <span class="n">pgdf_entry</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

                <span class="c1"># Now insert all the points into the database for this known</span>
                <span class="c1"># track.</span>
                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">track</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Points</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">sonarid</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">sonar_id</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">minbearing</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">min_bearing</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">maxbearing</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">max_bearing</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">minrange</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">min_range</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">maxrange</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">max_range</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">peakbearing</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">peak_bearing</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">maxvalue</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">occupancy</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">occupancy</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">objsize</span> <span class="o">==</span> <span class="n">point</span><span class="o">.</span><span class="n">obj_size</span><span class="p">,</span>
                        <span class="n">Points</span><span class="o">.</span><span class="n">track_id</span> <span class="o">==</span> <span class="n">track_obj</span><span class="o">.</span><span class="n">track_id</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">new_point</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>
                    <span class="c1"># No need to run an update existing point as a point</span>
                    <span class="c1"># is unique if any of it&#39;s attributes are different.</span>

                    <span class="k">if</span> <span class="n">new_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">new_point</span> <span class="o">=</span> <span class="n">Points</span><span class="p">(</span>
                            <span class="n">uid</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">(),</span>
                            <span class="n">time</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                            <span class="n">sonarid</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">sonar_id</span><span class="p">,</span>
                            <span class="n">minbearing</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">min_bearing</span><span class="p">,</span>
                            <span class="n">maxbearing</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">max_bearing</span><span class="p">,</span>
                            <span class="n">minrange</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">min_range</span><span class="p">,</span>
                            <span class="n">maxrange</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">max_range</span><span class="p">,</span>
                            <span class="n">peakbearing</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">peak_bearing</span><span class="p">,</span>
                            <span class="n">peakrange</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">peak_range</span><span class="p">,</span>
                            <span class="n">maxvalue</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span>
                            <span class="n">occupancy</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">occupancy</span><span class="p">,</span>
                            <span class="n">objsize</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">obj_size</span><span class="p">,</span>
                            <span class="n">track_id</span><span class="o">=</span><span class="n">track_obj</span><span class="o">.</span><span class="n">track_id</span><span class="p">,</span>
                            <span class="n">group_id</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">uid</span>
                        <span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Make sure this point has it&#39;s group_uid changed!</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">time</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">time</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">sonarid</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">sonar_id</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">minbearing</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">min_bearing</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">maxbearing</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">max_bearing</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">minrange</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">min_range</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">maxrange</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">max_range</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">peakbearing</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">peak_bearing</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">peakrange</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">peak_range</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">maxvalue</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">max_value</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">occupancy</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">occupancy</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">objsize</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">obj_size</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">track_id</span><span class="o">=</span><span class="n">track_obj</span><span class="o">.</span><span class="n">track_id</span>
                        <span class="n">new_point</span><span class="o">.</span><span class="n">group_id</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">uid</span>

                    <span class="n">new_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_point</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># This track isn&#39;t important so skip</span>
                <span class="c1"># print(e)</span>
                <span class="c1"># TODO - this try except thing is a bit naughty!</span>
                <span class="k">pass</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">new_pgdfs</span><span class="p">,</span> <span class="n">new_points</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sealhits.sources.pgdf.tracks_to_pgdfs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tracks_to_pgdfs</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Take the created TrackGroup list and return the PGDFs we need.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>tracks</code></b>
                  (<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="sealhits.db.dbschema.TrackGroup" href="#sealhits.db.dbschema.TrackGroup">TrackGroup</a>]</code>)
              –
              <div class="doc-md-description">
                <p>The TrackGroup list of interest.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[str]</code>
              –
              <div class="doc-md-description">
                <p>List[str]: List of PGDF filenames we need to cover these TrackGroup.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/pgdf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tracks_to_pgdfs</span><span class="p">(</span><span class="n">tracks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TrackGroup</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take the created TrackGroup list and return the PGDFs we need.</span>

<span class="sd">    Args:</span>
<span class="sd">        tracks (List[TrackGroup]): The TrackGroup list of interest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of PGDF filenames we need to cover these TrackGroup.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pgdfs_required</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>
        <span class="n">binfile</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">binfile</span>
        <span class="k">if</span> <span class="n">binfile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pgdfs_required</span><span class="p">:</span>
            <span class="n">pgdfs_required</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">binfile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pgdfs_required</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="ingesting-from-sqlite">Ingesting from sqlite</h2>


<div class="doc doc-object doc-module">



<a id="sealhits.sources.sqlpam"></a>
    <div class="doc doc-contents first">

      <p>sqlpam.py - Reading data from the annotation SQLite file.</p>


<details class="this-module-contains-the-following" open>
  <summary>This module contains the following</summary>
  <ul>
<li>SQLPAM - a class representing the PAM SQLITE file.</li>
<li>TrackChild - a class representing an individual track</li>
<li>TrackGroup - a group of TrackChild representing <em>something</em></li>
</ul>
</details>      <p>Examples:</p>
<pre><code>&gt;&gt;&gt; from pypam.sqlpam import SQLPAM
&gt;&gt;&gt; sqlitepath = "pam.sqlite3"
&gt;&gt;&gt; assert os.path.exists(sqlitepath)
&gt;&gt;&gt; sqlpam = SQLPAM(sqlitepath)
&gt;&gt;&gt; print(sqlpam.tables)
</code></pre>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sealhits.sources.sqlpam.SQLPAM" class="doc doc-heading">
            <code>SQLPAM</code>


</h2>


    <div class="doc doc-contents ">


      <p>The class that represents the data held in the SQLite
annotation database. This object will hold the TrackGroups and
TrackChilds.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/sources/sqlpam.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SQLPAM</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class that represents the data held in the SQLite</span>
<span class="sd">    annotation database. This object will hold the TrackGroups and</span>
<span class="sd">    TrackChilds.&quot;&quot;&quot;</span>

    <span class="c1"># TODO - just as with GLF, do we want to concat multiple files?</span>
    <span class="c1"># TODO - better checking for return values from the db (I.e missing)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sqlite_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise our SQLPAM object</span>

<span class="sd">        Args:</span>
<span class="sd">            sqlite_path (str): full path and name of the sqlite_path file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">sqlite_path</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT name FROM sqlite_master&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">track_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_children</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT ID, UID, UTC, PCLocalTime, PCTime, </span><span class="se">\</span>
<span class="s2">            ChannelBitmap, EndTime, DataCount, Track_Type, </span><span class="se">\</span>
<span class="s2">                Marine_Mammal, Fish, Bird, Interaction_with_blades, </span><span class="se">\</span>
<span class="s2">                    Comment FROM Track_Groups&quot;</span>
        <span class="p">)</span>
        <span class="n">tracks</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">id_uid_lookup</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># TODO - could do some inner join stuff here instead of python combine</span>
        <span class="c1"># Read the track groups first off</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">uid</span><span class="p">,</span>
            <span class="n">utc</span><span class="p">,</span>
            <span class="n">pclocal</span><span class="p">,</span>
            <span class="n">pctime</span><span class="p">,</span>
            <span class="n">cbitmap</span><span class="p">,</span>
            <span class="n">endtime</span><span class="p">,</span>
            <span class="n">dcount</span><span class="p">,</span>
            <span class="n">ttype</span><span class="p">,</span>
            <span class="n">mammal</span><span class="p">,</span>
            <span class="n">fish</span><span class="p">,</span>
            <span class="n">bird</span><span class="p">,</span>
            <span class="n">interaction</span><span class="p">,</span>
            <span class="n">comment</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>

            <span class="c1"># We need extra checks here to make sure</span>
            <span class="c1"># numerics are indeed numerics. SQLLite DB has a number</span>
            <span class="c1"># of mistakes.</span>

            <span class="k">if</span> <span class="n">mammal</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">mammal</span><span class="p">):</span>
                <span class="n">mammal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">if</span> <span class="n">fish</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">fish</span><span class="p">):</span>
                <span class="n">fish</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">if</span> <span class="n">bird</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">bird</span><span class="p">):</span>
                <span class="n">bird</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># This is very annoying and silly</span>
            <span class="k">if</span> <span class="n">interaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;1&quot;</span> <span class="ow">in</span> <span class="n">interaction</span><span class="p">:</span>
                    <span class="n">interact</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="ow">in</span> <span class="n">interaction</span><span class="p">:</span>
                    <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">elif</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">interaction</span><span class="p">):</span>
                    <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">elif</span> <span class="n">interaction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">interact</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">elif</span> <span class="n">interaction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">tg</span> <span class="o">=</span> <span class="n">TrackGroup</span><span class="p">(</span>
                <span class="nb">id</span><span class="p">,</span>
                <span class="n">uid</span><span class="p">,</span>
                <span class="n">utc</span><span class="p">,</span>
                <span class="n">pclocal</span><span class="p">,</span>
                <span class="n">pctime</span><span class="p">,</span>
                <span class="n">cbitmap</span><span class="p">,</span>
                <span class="n">endtime</span><span class="p">,</span>
                <span class="n">dcount</span><span class="p">,</span>
                <span class="n">ttype</span><span class="p">,</span>
                <span class="n">comment</span><span class="p">,</span>
                <span class="n">mammal</span><span class="p">,</span>
                <span class="n">fish</span><span class="p">,</span>
                <span class="n">bird</span><span class="p">,</span>
                <span class="n">interact</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">track_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tg</span><span class="p">)</span>

            <span class="c1"># Use a composite key as only id and uid combined are unique</span>
            <span class="n">id_uid_lookup</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">uid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tg</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT UID, UTC, PCLocalTime, PCTime, </span><span class="se">\</span>
<span class="s2">            ChannelBitmap, parentID, parentUID, LongDataName, </span><span class="se">\</span>
<span class="s2">                BinaryFile FROM Track_Groups_Children where </span><span class="se">\</span>
<span class="s2">                    BinaryFile is not null&quot;</span>
        <span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="c1"># Read the track children, adding them to their parent</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">uid</span><span class="p">,</span>
            <span class="n">utc</span><span class="p">,</span>
            <span class="n">pclocal</span><span class="p">,</span>
            <span class="n">pctime</span><span class="p">,</span>
            <span class="n">cbitmap</span><span class="p">,</span>
            <span class="n">parentid</span><span class="p">,</span>
            <span class="n">parentuid</span><span class="p">,</span>
            <span class="n">ldata</span><span class="p">,</span>
            <span class="n">bfile</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="n">TrackChild</span><span class="p">(</span>
                <span class="n">uid</span><span class="p">,</span>
                <span class="n">utc</span><span class="p">,</span>
                <span class="n">pclocal</span><span class="p">,</span>
                <span class="n">pctime</span><span class="p">,</span>
                <span class="n">cbitmap</span><span class="p">,</span>
                <span class="n">parentid</span><span class="p">,</span>
                <span class="n">parentuid</span><span class="p">,</span>
                <span class="n">ldata</span><span class="p">,</span>
                <span class="n">bfile</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">id_uid_lookup</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">parent_uid</span><span class="p">)]</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sealhits.sources.sqlpam.SQLPAM.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">sqlite_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Initialise our SQLPAM object</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sqlite_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>full path and name of the sqlite_path file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/sqlpam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sqlite_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise our SQLPAM object</span>

<span class="sd">    Args:</span>
<span class="sd">        sqlite_path (str): full path and name of the sqlite_path file.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">sqlite_path</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT name FROM sqlite_master&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">track_groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">track_children</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;SELECT ID, UID, UTC, PCLocalTime, PCTime, </span><span class="se">\</span>
<span class="s2">        ChannelBitmap, EndTime, DataCount, Track_Type, </span><span class="se">\</span>
<span class="s2">            Marine_Mammal, Fish, Bird, Interaction_with_blades, </span><span class="se">\</span>
<span class="s2">                Comment FROM Track_Groups&quot;</span>
    <span class="p">)</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">id_uid_lookup</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># TODO - could do some inner join stuff here instead of python combine</span>
    <span class="c1"># Read the track groups first off</span>
    <span class="k">for</span> <span class="p">(</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">uid</span><span class="p">,</span>
        <span class="n">utc</span><span class="p">,</span>
        <span class="n">pclocal</span><span class="p">,</span>
        <span class="n">pctime</span><span class="p">,</span>
        <span class="n">cbitmap</span><span class="p">,</span>
        <span class="n">endtime</span><span class="p">,</span>
        <span class="n">dcount</span><span class="p">,</span>
        <span class="n">ttype</span><span class="p">,</span>
        <span class="n">mammal</span><span class="p">,</span>
        <span class="n">fish</span><span class="p">,</span>
        <span class="n">bird</span><span class="p">,</span>
        <span class="n">interaction</span><span class="p">,</span>
        <span class="n">comment</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>

        <span class="c1"># We need extra checks here to make sure</span>
        <span class="c1"># numerics are indeed numerics. SQLLite DB has a number</span>
        <span class="c1"># of mistakes.</span>

        <span class="k">if</span> <span class="n">mammal</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">mammal</span><span class="p">):</span>
            <span class="n">mammal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">fish</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">fish</span><span class="p">):</span>
            <span class="n">fish</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">bird</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">bird</span><span class="p">):</span>
            <span class="n">bird</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># This is very annoying and silly</span>
        <span class="k">if</span> <span class="n">interaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;1&quot;</span> <span class="ow">in</span> <span class="n">interaction</span><span class="p">:</span>
                <span class="n">interact</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="ow">in</span> <span class="n">interaction</span><span class="p">:</span>
                <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">interaction</span><span class="p">):</span>
                <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">interaction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">interact</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">interaction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">interact</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">tg</span> <span class="o">=</span> <span class="n">TrackGroup</span><span class="p">(</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">uid</span><span class="p">,</span>
            <span class="n">utc</span><span class="p">,</span>
            <span class="n">pclocal</span><span class="p">,</span>
            <span class="n">pctime</span><span class="p">,</span>
            <span class="n">cbitmap</span><span class="p">,</span>
            <span class="n">endtime</span><span class="p">,</span>
            <span class="n">dcount</span><span class="p">,</span>
            <span class="n">ttype</span><span class="p">,</span>
            <span class="n">comment</span><span class="p">,</span>
            <span class="n">mammal</span><span class="p">,</span>
            <span class="n">fish</span><span class="p">,</span>
            <span class="n">bird</span><span class="p">,</span>
            <span class="n">interact</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">track_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tg</span><span class="p">)</span>

        <span class="c1"># Use a composite key as only id and uid combined are unique</span>
        <span class="n">id_uid_lookup</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">uid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tg</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;SELECT UID, UTC, PCLocalTime, PCTime, </span><span class="se">\</span>
<span class="s2">        ChannelBitmap, parentID, parentUID, LongDataName, </span><span class="se">\</span>
<span class="s2">            BinaryFile FROM Track_Groups_Children where </span><span class="se">\</span>
<span class="s2">                BinaryFile is not null&quot;</span>
    <span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="c1"># Read the track children, adding them to their parent</span>
    <span class="k">for</span> <span class="p">(</span>
        <span class="n">uid</span><span class="p">,</span>
        <span class="n">utc</span><span class="p">,</span>
        <span class="n">pclocal</span><span class="p">,</span>
        <span class="n">pctime</span><span class="p">,</span>
        <span class="n">cbitmap</span><span class="p">,</span>
        <span class="n">parentid</span><span class="p">,</span>
        <span class="n">parentuid</span><span class="p">,</span>
        <span class="n">ldata</span><span class="p">,</span>
        <span class="n">bfile</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="n">TrackChild</span><span class="p">(</span>
            <span class="n">uid</span><span class="p">,</span>
            <span class="n">utc</span><span class="p">,</span>
            <span class="n">pclocal</span><span class="p">,</span>
            <span class="n">pctime</span><span class="p">,</span>
            <span class="n">cbitmap</span><span class="p">,</span>
            <span class="n">parentid</span><span class="p">,</span>
            <span class="n">parentuid</span><span class="p">,</span>
            <span class="n">ldata</span><span class="p">,</span>
            <span class="n">bfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">id_uid_lookup</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">parent_uid</span><span class="p">)]</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sealhits.sources.sqlpam.TrackChild" class="doc doc-heading">
            <code>TrackChild</code>


</h2>


    <div class="doc doc-contents ">


      <p>The class representing the individual track from the PAMGUARD
pgdf binary file. It contains a UID link to the gemini object from
the PGDF.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/sources/sqlpam.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TrackChild</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class representing the individual track from the PAMGUARD</span>
<span class="sd">    pgdf binary file. It contains a UID link to the gemini object from</span>
<span class="sd">    the PGDF.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">uid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">utc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pc_local</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">parent_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">parent_uid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">long_data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">binary_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise our TrackChild Object.</span>

<span class="sd">        Args:</span>
<span class="sd">            uid (int): a unique identifier matching the PGDF binary track.</span>
<span class="sd">            utc (str): a string representing the time in UTC.</span>
<span class="sd">            pc_local (str): the local time on the pc recording.</span>
<span class="sd">            pc_time (str): the time on the pc recording.</span>
<span class="sd">            channel (int): unknown.</span>
<span class="sd">            parent_id (int): The ID of the TrackGroup to which this child belongs.</span>
<span class="sd">            parent_uid (int): The UID of the TrackGroup to which this child belongs.</span>
<span class="sd">            long_data_name (str): unknown.</span>
<span class="sd">            binary_file (str): The filename of the PGDF that holds this track.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc_local_time</span> <span class="o">=</span> <span class="n">pc_local</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc_time</span> <span class="o">=</span> <span class="n">pc_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_bitmap</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_uid</span> <span class="o">=</span> <span class="n">parent_uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_data_name</span> <span class="o">=</span> <span class="n">long_data_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Fix for the bug in pamguard with the binary file</span>
        <span class="k">if</span> <span class="n">binary_file</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;i_&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_file</span> <span class="o">=</span> <span class="s2">&quot;Gemin&quot;</span> <span class="o">+</span> <span class="n">binary_file</span>


    <span class="k">def</span> <span class="nf">_add_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">TrackGroup</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_local_time</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_time</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_bitmap</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_uid</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_data_name</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary_file</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sealhits.sources.sqlpam.TrackChild.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">utc</span><span class="p">,</span> <span class="n">pc_local</span><span class="p">,</span> <span class="n">pc_time</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="n">parent_uid</span><span class="p">,</span> <span class="n">long_data_name</span><span class="p">,</span> <span class="n">binary_file</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Initialise our TrackChild Object.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uid</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>a unique identifier matching the PGDF binary track.</p>
              </div>
            </li>
            <li>
              <b><code>utc</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>a string representing the time in UTC.</p>
              </div>
            </li>
            <li>
              <b><code>pc_local</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the local time on the pc recording.</p>
              </div>
            </li>
            <li>
              <b><code>pc_time</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>the time on the pc recording.</p>
              </div>
            </li>
            <li>
              <b><code>channel</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>unknown.</p>
              </div>
            </li>
            <li>
              <b><code>parent_id</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The ID of the TrackGroup to which this child belongs.</p>
              </div>
            </li>
            <li>
              <b><code>parent_uid</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The UID of the TrackGroup to which this child belongs.</p>
              </div>
            </li>
            <li>
              <b><code>long_data_name</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>unknown.</p>
              </div>
            </li>
            <li>
              <b><code>binary_file</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename of the PGDF that holds this track.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/sqlpam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">uid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">utc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pc_local</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">parent_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">parent_uid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">long_data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">binary_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise our TrackChild Object.</span>

<span class="sd">    Args:</span>
<span class="sd">        uid (int): a unique identifier matching the PGDF binary track.</span>
<span class="sd">        utc (str): a string representing the time in UTC.</span>
<span class="sd">        pc_local (str): the local time on the pc recording.</span>
<span class="sd">        pc_time (str): the time on the pc recording.</span>
<span class="sd">        channel (int): unknown.</span>
<span class="sd">        parent_id (int): The ID of the TrackGroup to which this child belongs.</span>
<span class="sd">        parent_uid (int): The UID of the TrackGroup to which this child belongs.</span>
<span class="sd">        long_data_name (str): unknown.</span>
<span class="sd">        binary_file (str): The filename of the PGDF that holds this track.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pc_local_time</span> <span class="o">=</span> <span class="n">pc_local</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pc_time</span> <span class="o">=</span> <span class="n">pc_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">channel_bitmap</span> <span class="o">=</span> <span class="n">channel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">parent_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent_uid</span> <span class="o">=</span> <span class="n">parent_uid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">long_data_name</span> <span class="o">=</span> <span class="n">long_data_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Fix for the bug in pamguard with the binary file</span>
    <span class="k">if</span> <span class="n">binary_file</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;i_&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binary_file</span> <span class="o">=</span> <span class="s2">&quot;Gemin&quot;</span> <span class="o">+</span> <span class="n">binary_file</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sealhits.sources.sqlpam.TrackGroup" class="doc doc-heading">
            <code>TrackGroup</code>


</h2>


    <div class="doc doc-contents ">


      <p>A group of TrackChild that may have annotations.</p>

              <details class="quote">
                <summary>Source code in <code>sealhits/sources/sqlpam.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TrackGroup</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A group of TrackChild that may have annotations.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">uid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">utc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pc_local</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dc</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">track_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mammal</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">fish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">bird</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interact</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise our TrackGroup Object.</span>

<span class="sd">        Args:</span>

<span class="sd">            uid (int): a unique identifier matching the PGDF binary track, although not that unique it seems :/</span>
<span class="sd">            utc (str): a string representing the time in UTC.</span>
<span class="sd">            utc_milli (int): an int number of milliseconds since the epoch in utc.</span>
<span class="sd">            pc_local (str): the local time on the pc recording.</span>
<span class="sd">            pc_time (str): the time on the pc recording.</span>
<span class="sd">            channel (int): unknown.</span>
<span class="sd">            end_time (str): When does the last Track in this group finish?</span>
<span class="sd">            dc (int): unknown.</span>
<span class="sd">            track_type (str): unknown.</span>
<span class="sd">            comment (str):</span>
<span class="sd">            mammal (int): Was this trackgroup a mammal?</span>
<span class="sd">            fish (int): Was this trackgroup a fish?</span>
<span class="sd">            bird (int): Was this trackgroup a bird?</span>
<span class="sd">            interact (bool): Did this trackgroup interact with the turbine?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc_local_time</span> <span class="o">=</span> <span class="n">pc_local</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc_time</span> <span class="o">=</span> <span class="n">pc_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_bitmap</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_count</span> <span class="o">=</span> <span class="n">dc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_type</span> <span class="o">=</span> <span class="n">track_type</span>  <span class="c1"># TODO - enum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mammal</span> <span class="o">=</span> <span class="n">mammal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fish</span> <span class="o">=</span> <span class="n">fish</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bird</span> <span class="o">=</span> <span class="n">bird</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interaction</span> <span class="o">=</span> <span class="n">interact</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_local_time</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_time</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_bitmap</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_count</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track_type</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marine_mammal</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fish</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bird</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interaction</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="n">TrackChild</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a TrackChild to this TrackGroup.</span>

<span class="sd">        Args:</span>
<span class="sd">            child (TrackChild): a TrackChild object to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">child</span><span class="o">.</span><span class="n">parent_uid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">_add_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sealhits.sources.sqlpam.TrackGroup.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">utc</span><span class="p">,</span> <span class="n">pc_local</span><span class="p">,</span> <span class="n">pc_time</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">dc</span><span class="p">,</span> <span class="n">track_type</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">mammal</span><span class="p">,</span> <span class="n">fish</span><span class="p">,</span> <span class="n">bird</span><span class="p">,</span> <span class="n">interact</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Initialise our TrackGroup Object.</p>
<p>Args:</p>
<pre><code>uid (int): a unique identifier matching the PGDF binary track, although not that unique it seems :/
utc (str): a string representing the time in UTC.
utc_milli (int): an int number of milliseconds since the epoch in utc.
pc_local (str): the local time on the pc recording.
pc_time (str): the time on the pc recording.
channel (int): unknown.
end_time (str): When does the last Track in this group finish?
dc (int): unknown.
track_type (str): unknown.
comment (str):
mammal (int): Was this trackgroup a mammal?
fish (int): Was this trackgroup a fish?
bird (int): Was this trackgroup a bird?
interact (bool): Did this trackgroup interact with the turbine?
</code></pre>

            <details class="quote">
              <summary>Source code in <code>sealhits/sources/sqlpam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="nb">id</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">uid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">utc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pc_local</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dc</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">track_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mammal</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">fish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">bird</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">interact</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise our TrackGroup Object.</span>

<span class="sd">    Args:</span>

<span class="sd">        uid (int): a unique identifier matching the PGDF binary track, although not that unique it seems :/</span>
<span class="sd">        utc (str): a string representing the time in UTC.</span>
<span class="sd">        utc_milli (int): an int number of milliseconds since the epoch in utc.</span>
<span class="sd">        pc_local (str): the local time on the pc recording.</span>
<span class="sd">        pc_time (str): the time on the pc recording.</span>
<span class="sd">        channel (int): unknown.</span>
<span class="sd">        end_time (str): When does the last Track in this group finish?</span>
<span class="sd">        dc (int): unknown.</span>
<span class="sd">        track_type (str): unknown.</span>
<span class="sd">        comment (str):</span>
<span class="sd">        mammal (int): Was this trackgroup a mammal?</span>
<span class="sd">        fish (int): Was this trackgroup a fish?</span>
<span class="sd">        bird (int): Was this trackgroup a bird?</span>
<span class="sd">        interact (bool): Did this trackgroup interact with the turbine?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pc_local_time</span> <span class="o">=</span> <span class="n">pc_local</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pc_time</span> <span class="o">=</span> <span class="n">pc_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">channel_bitmap</span> <span class="o">=</span> <span class="n">channel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_count</span> <span class="o">=</span> <span class="n">dc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">track_type</span> <span class="o">=</span> <span class="n">track_type</span>  <span class="c1"># TODO - enum</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mammal</span> <span class="o">=</span> <span class="n">mammal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fish</span> <span class="o">=</span> <span class="n">fish</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bird</span> <span class="o">=</span> <span class="n">bird</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">interaction</span> <span class="o">=</span> <span class="n">interact</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sealhits.sources.sqlpam.TrackGroup.add_child" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Add a TrackChild to this TrackGroup.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>child</code></b>
                  (<code><a class="autorefs autorefs-internal" title="sealhits.sources.sqlpam.TrackChild" href="#sealhits.sources.sqlpam.TrackChild">TrackChild</a></code>)
              –
              <div class="doc-md-description">
                <p>a TrackChild object to add.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>sealhits/sources/sqlpam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="n">TrackChild</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a TrackChild to this TrackGroup.</span>

<span class="sd">    Args:</span>
<span class="sd">        child (TrackChild): a TrackChild object to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">child</span><span class="o">.</span><span class="n">parent_uid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="n">child</span><span class="o">.</span><span class="n">_add_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../how-to-guides/" class="btn btn-neutral float-left" title="How-to guides"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../explanation/" class="btn btn-neutral float-right" title="Explanation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../how-to-guides/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../explanation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
